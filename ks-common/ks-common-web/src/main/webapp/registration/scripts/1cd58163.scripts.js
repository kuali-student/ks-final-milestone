"use strict";function denullify(a){return null===a?"":a}function zeroPad(a){for(a=""+a;a.length<3;)a="0"+a;return a}angular.module("regCartApp",["configuration","ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){b.otherwise("/myCart");var d={templateUrl:"partials/cart.html",controller:"CartCtrl"},e={templateUrl:"partials/schedule.html",controller:"ScheduleCtrl"};a.state("root",{"abstract":!0,views:{root:{templateUrl:"partials/main.html",controller:"MainCtrl"}}}).state("root.schedule",{url:"/mySchedule",views:{"":e,mycart:d,schedule:e}}).state("root.cart",{url:"/myCart",views:{"":e,mycart:d,schedule:e}}).state("root.search",{url:"/search",views:{"":{templateUrl:"partials/search.html"},mycart:d,schedule:e}}).state("root.search.results",{url:"/{searchCriteria}",views:{"":{templateUrl:"partials/searchResults.html",controller:"SearchCtrl"}}}).state("root.search.details",{url:"/{searchCriteria}/{id}",templateUrl:"partials/searchDetails.html",controller:"SearchDetailsCtrl"}),c.interceptors.push("loginInterceptor")}]),angular.module("configuration",[]).value("APP_URL","ks-with-rice-bundled-dev/services/").value("DEFAULT_TERM","kuali.atp.2012Fall"),angular.module("regCartApp").constant("URLS",{scheduleOfClasses:"ScheduleOfClassesClientService",courseRegistration:"CourseRegistrationClientService",courseRegistrationCart:"CourseRegistrationCartClientService",developmentLogin:"DevelopmentLoginClientService"}).constant("STATE",function(){var a={failed:"kuali.lpr.trans.state.failed",processing:"kuali.lpr.trans.state.processing",succeeded:"kuali.lpr.trans.state.succeeded",item:{failed:"kuali.lpr.trans.item.state.failed",processing:"kuali.lpr.trans.item.state.processing",succeeded:"kuali.lpr.trans.item.state.succeeded",waitlist:"kuali.lpr.trans.item.state.waitlist",waitlistActionAvailable:"kuali.lpr.trans.item.state.waitlistActionAvailable"}};return{lpr:a,action:[a.item.waitlistActionAvailable],error:[a.failed,a.item.failed],processing:[a.processing,a.item.processing],success:[a.succeeded,a.item.succeeded],waitlist:[a.item.waitlist]}}()).constant("STATUS",{action:"action",editing:"editing",error:"error","new":"new",processing:"processing",success:"success",waitlist:"waitlist"}).constant("COURSE_TYPES",{registered:"registered",waitlisted:"waitlist",cart:"cart"}).constant("GRADING_OPTION",{audit:"kuali.resultComponent.grade.audit",letter:"kuali.resultComponent.grade.letter",passFail:"kuali.resultComponent.grade.passFail"}).constant("ACTION_LINK",{removeItemFromCart:"removeItemFromCart",undoDeleteCourse:"undoDeleteCourse"}).constant("VALIDATION_ERROR_TYPE",{maxCredits:"kuali.lpr.trans.message.credit.load.exceeded",timeConflict:"kuali.lpr.trans.message.time.conflict",waitlistAvailable:"kuali.lpr.trans.message.waitlist.available",waitlistWaitlisted:"kuali.lpr.trans.message.waitlist.waitlisted",waitlistFull:"kuali.lpr.trans.message.waitlist.full",waitlistNotOffered:"kuali.lpr.trans.message.waitlist.not.offered",transactionException:"kuali.lpr.trans.message.exception",transactionItemException:"kuali.lpr.trans.item.message.exception"}).constant("VALIDATION_SUCCESS_TYPE",{waitlistStudentRemoved:"kuali.lpr.trans.message.waitlist.student.removed",waitlistUpdated:"kuali.lpr.trans.message.waitlist.options.updated",courseUpdated:"kuali.lpr.trans.message.course.updated",courseDropped:"kuali.lpr.trans.message.course.dropped",personRegistered:"kuali.lpr.trans.message.person.registered"}).constant("DAY_CONSTANTS",{monday:"M",tuesday:"Tu",wednesday:"W",thursday:"Th",friday:"F",saturday:"Sa",sunday:"Su",dayArray:["M","Tu","W","Th","F","Sa","Su"]}),angular.module("regCartApp").constant("SEARCH_FACETS",[{label:"Seats",id:"seatsAvailable",autoCollapse:!1,optionsProvider:function(a){var b=0;angular.forEach(a,function(a){a.seatsAvailable>0&&b++});var c=[];return b>0&&c.push({label:"Seats available",value:"seatsAvailable",count:b}),c},filter:function(a){return a.seatsAvailable>0}},{label:"Credits",id:"creditOptions",optionsKey:"creditOptions",refine:function(a){var b=[];return angular.forEach(a,function(a){var c=Math.floor(a.value),d=c;c>6&&(c=6,d="6+");for(var e=null,f=0;f<b.length;f++)if(-1!==b[f].value.indexOf(c)){e=b[f];break}null===e?(a.label=d,a.count=0,a.value=[a.value],-1===a.value.indexOf(c)&&a.value.push(c),b.push(a)):(-1===e.value.indexOf(a.value)&&e.value.push(c),e.label=d)}),b}},{label:"Course Level",id:"courseLevel",optionsKey:"courseLevel"},{label:"Course Prefix",id:"coursePrefix",optionsKey:"coursePrefix"}]),angular.module("regCartApp").controller("MainCtrl",["$scope","$location","$state","TermsService","ScheduleService","GlobalVarsService","APP_URL","DEFAULT_TERM","LoginService","MessageService","$modal",function(a,b,c,d,e,f,g,h,i,j,k){console.log("In Main Controller"),a.appUrl=g.replace("/services/","/"),a.termId=null,a.termName="",a.studentIsEligibleForTerm=!0,a.$watch("termId",function(b,c){b!==c&&(a.termName=d.getTermNameForTermId(a.terms,b),b===h?(console.log("checking term eligibility"),d.checkStudentEligibilityForTerm().query({termId:b},function(d){a.studentIsEligibleForTerm=angular.isDefined(d.isEligible)&&d.isEligible||!1,a.studentIsEligibleForTerm?a.$broadcast("termIdChanged",b,c):(f.setUserId(d.userId),a.userId=f.getUserId)},function(b){console.log("Error while checking if term is open for registration",b),a.studentIsEligibleForTerm=!1})):(console.log("term eligibility check bypassed - term != default term"),a.studentIsEligibleForTerm=!0,a.$broadcast("termIdChanged",b,c)))}),a.$on("termIdChanged",function(b,c){e.getSchedule(c).then(function(b){console.log("called rest service to get schedule data - in main.js"),f.updateScheduleCounts(b),a.cartCredits=f.getCartCredits,a.cartCourseCount=f.getCartCourseCount,a.registeredCredits=f.getRegisteredCredits,a.registeredCourseCount=f.getRegisteredCourseCount,a.waitlistedCredits=f.getWaitlistedCredits,a.waitlistedCourseCount=f.getWaitlistedCourseCount,a.showWaitlistedSection=f.getShowWaitlistedSection,a.userId=f.getUserId})}),d.getTerms().then(function(b){a.terms=b,a.termId=h,a.termName=d.getTermNameForTermId(b,a.termId)}),j.getMessages().then(function(b){a.messages=b}),a.logout=function(){i.logout().query({},function(){console.log("Logging out"),location.reload()})},a.goToPage=function(a){console.log("Navigating to page: "+a),b.url(a)},a.$on("sessionExpired",function(){console.log("Received event sessionExpired"),k.open({backdrop:"static",templateUrl:"partials/sessionExpired.html",controller:"SessionCtrl"})}),a.$parent.uiState=c.current.name,a.$on("$stateChangeStart",function(b,c){a.$parent.uiState=c.name})}]).controller("SessionCtrl",["$scope","LoginService",function(a,b){a.logout=function(){b.logout().query({},function(){console.log("Session expired...logging out"),location.reload()})}}]),angular.module("regCartApp").controller("CartCtrl",["$scope","$modal","$timeout","STATE","STATUS","GRADING_OPTION","ACTION_LINK","COURSE_TYPES","CartService","ScheduleService","GlobalVarsService",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){i.getCart(b).then(function(b){a.cart=b;var c=[],f=null;angular.forEach(a.cart.items,function(b){if(q(b),k.getCorrespondingStatusFromState(b.state)===e.processing){b.status=e.processing;var g=angular.copy(b);a.cartResults.items.push(g),a.cartResults.state=d.lpr.processing,a.cartResults.status=e.processing,f=b.cartId}else c.push(b)}),a.cart.items=c,null!==f&&n(f)})}function m(d,g,h,j,k,l,n){a.courseAdded=!1,g&&(g=g.toUpperCase()),i.addCourseToCart().query({cartId:d,courseCode:g,termId:h,regGroupCode:j,regGroupId:k,gradingOptionId:l,credits:n},function(b){console.log("Searched for course: "+a.courseCode+" "+a.regCode+", Term: "+a.termId),a.courseCode="",a.regCode="",q(b),a.cart.items.unshift(b),console.log("Started to glow..."),b.addingNewCartItem=!0,c(function(){b.addingNewCartItem=!1},2e3),a.courseAdded=!0},function(c){console.log("CartId:",d),404===c.status?(a.userMessage={txt:c.data,type:e.error,course:g},a.courseAdded=!0):400===c.status?(console.log("CartId: ",d),b.open({backdrop:"static",templateUrl:"partials/additionalOptions.html",resolve:{item:function(){return c.data},cartId:function(){return d}},controller:["$scope","item","cartId",function(a,b,c){console.log("Controller for modal... Item: ",b),a.newCartItem=b,a.newCartItem.credits=a.newCartItem.newCredits=a.newCartItem.creditOptions[0],a.newCartItem.gradingOptionId=a.newCartItem.newGrading=f.letter,a.newCartItem.editing=!0,a.dismissAdditionalOptions=function(){console.log("Dismissing credits and grading"),a.$close(!0)};var d=!1;a.saveAdditionalOptions=function(b){d||(d=!0,b.editing=!1,console.log("Save credits and grading for cartId:",c),m(c,a.newCartItem.courseCode,a.newCartItem.termId,a.newCartItem.regGroupCode,a.newCartItem.regGroupId,a.newCartItem.newGrading,a.newCartItem.newCredits),a.$close(!0))}}]}),a.courseAdded=!0):(console.log("Error with adding course",c.data.consoleMessage),a.userMessage={txt:c.data.genericMessage,type:c.data.type,detail:c.data.detailedMessage,course:g+" ("+j+")"},a.courseAdded=!0)})}function n(b){j.pollRegistrationRequestStatus(b).then(function(b){console.log("- Stop polling - Success"),a.cart.state=b.state,a.cart.status="",a.cartResults.state=d.lpr.item.succeeded,angular.forEach(b.responseItemResults,function(b){angular.forEach(a.cartResults.items,function(a){if(a.cartItemId===b.registrationRequestItemId)switch(a.state=b.state,a.type=b.type,a.status=k.getCorrespondingStatusFromState(b.state),a.statusMessages=b.messages,a.status){case e.waitlist:case e.action:a.waitlistMessage=k.getCorrespondingMessageFromStatus(a.status)}})}),o(!0),j.getSchedule(a.termId,!0).then(function(b){console.log("called rest service to get schedule data - in cart.js"),k.updateScheduleCounts(b),a.registeredCredits=k.getRegisteredCredits,a.registeredCourseCount=k.getRegisteredCourseCount})},function(a){console.log("- Stop polling - Error: ",a)},function(b){console.log("- Continue polling"),a.cart.state=b.state})}function o(b){b&&(a.cartResults.successCount=0,a.cartResults.waitlistCount=0,a.cartResults.waitlistedCount=0,a.cartResults.errorCount=0);var c=0,d=0,f=0,g=0;angular.forEach(a.cartResults.items,function(a){switch(a.status){case e.success:c++;break;case e.waitlist:c++,f++;break;case e.action:d++;break;case e.error:g++}}),a.cartResults.successCount=c,a.cartResults.waitlistCount=d,a.cartResults.waitlistedCount=f,a.cartResults.errorCount=g}function p(){if(!a.cart)return 0;for(var b=0,c=0;c<a.cart.items.length;c++)b+=Number(a.cart.items[c].credits);return b}function q(a){a.longName=a.courseTitle,a.gradingOptionId=a.grading}a.states=d,a.statuses=e,a.courseTypes=h,a.oneAtATime=!1,a.isCollapsed=!0,a.cartResults={items:[]},a.$on("termIdChanged",function(b,c){console.log("term id has changed - cart: "+c),a.cartResults.items.splice(0,a.cartResults.items.length),a.userMessage&&a.userMessage.txt&&a.removeUserMessage(),l(c)}),a.$watchCollection("cart.items",function(b){a.creditTotal=p(),b&&k.setCartCredits(a.creditTotal),k.setCartCourses(b)}),a.termId&&l(a.termId),a.courseIndex=function(a){return angular.isDefined(a.index)&&a.index||(a.index=k.getCourseIndex(a)),a.index},a.getStatusMessageFromStatus=function(a){var b="";return a===e.success?b=" - Success!":(a===e.error||a===e.action)&&(b=" - Failed"),b},a.addRegGroupToCart=function(){m(a.cart.cartId,a.courseCode,a.termId,a.regCode,null,null,null)},a.$on("addRegGroupIdToCart",function(a,b){m(null,null,null,null,b,null,null)}),a.addCartItemToCart=function(b){m(a.cart.cartId,null,a.termId,null,b.regGroupId,b.gradingOptionId,b.credits)},a.$on("addCourseToCart",function(a,b,c,d,e,f,g,h){console.log("Received event addCourseToCart ",a),m(b,c,d,e,f,g,h)}),a.cancelNewCartItem=function(){a.newCartItem=null,a.showNew=!1},a.$on("deleteCartItem",function(b,c){var d=c.actionLinks,f=null;angular.forEach(d,function(a){a.action===g.removeItemFromCart&&(f=a.uri)}),i.removeItemFromCart(f).query({},function(b){console.log("Cart item removed",b),a.cart.items.splice(a.cart.items.indexOf(c),1);var d=null;angular.forEach(b.actionLinks,function(a){a.action===g.undoDeleteCourse&&(d=a.uri)}),a.userMessage={txt:"Removed <b>"+c.courseCode+"("+c.regGroupCode+")</b>",actionLink:d,linkText:"Undo",type:e.success}})}),a.$on("updateCourse",function(b,c,d,e,f,g){c===h.cart&&(console.log("Updating cart item"),i.updateCartItem().query({cartId:a.cart.cartId,cartItemId:d.cartItemId,credits:e.credits,gradingOptionId:e.gradingOptionId},function(){console.log("- Cart item successfully updated"),angular.isFunction(f)&&f()},function(a){console.log("- Error updating cart item",a),angular.isFunction(g)&&g(a.genericMessage)}))}),a.invokeActionLink=function(b){i.invokeActionLink(b).query({},function(b){q(b),a.cart.items.unshift(b),a.removeUserMessage()})},a.addCartItemToWaitlist=function(a){console.log("Adding cart item to waitlist... "),j.registerForRegistrationGroup().query({courseCode:a.courseCode,regGroupId:a.regGroupId,gradingOption:a.gradingOptionId,credits:a.credits,allowWaitlist:!0},function(b){a.state=d.lpr.item.processing,a.status=e.processing,a.cartItemId=b.registrationRequestItems[0].id,c(function(){console.log("Just waited 250, now start the polling"),n(b.id)},250)})},a.removeAlertMessage=function(a){a.alertMessage=null},a.removeUserMessage=function(){a.userMessage&&(a.userMessage.txt=null,a.userMessage.linkText=null)},a.removeCartResultItem=function(b){a.cartResults.items.splice(b,1),o()},a.register=function(){i.submitCart().query({cartId:a.cart.cartId},function(b){console.log("Submitted cart. RegReqId["+b.id+"]"),a.removeUserMessage(),a.cartResults=angular.copy(a.cart),a.cart.items.splice(0,a.cart.items.length),a.showConfirmation=!1,a.cartResults.state=d.lpr.processing,a.cartResults.status=e.processing,a.creditTotal=0,angular.forEach(a.cartResults.items,function(a){a.state=d.lpr.item.processing,a.status=e.processing}),c(function(){console.log("Just waited 250, now start the polling"),n(b.id)},250)})}}]),angular.module("regCartApp").controller("ScheduleCtrl",["$scope","$modal","$timeout","STATUS","GRADING_OPTION","COURSE_TYPES","ScheduleService","GlobalVarsService",function(a,b,c,d,e,f,g,h){function i(b,c,d,e,i,j){i(j,function(i){console.log("- Drop course registration request submitted - starting to poll for request status"),g.pollRegistrationRequestStatus(i.id).then(function(){switch(console.log("-- Stop polling - Success"),b){case f.waitlisted:h.removeWaitlistedCourse(c),k++;break;case f.registered:h.removeRegisteredCourse(c),l++}angular.isFunction(d)&&d(),a.$emit("courseDropped",c,b)},function(a){console.log("-- Stop polling - Error",a),angular.isFunction(e)&&e(a.responseItemResults[0].messages[0])},function(){console.log("-- Continue polling")})},function(a){console.log("- Drop course registration request failed",a),angular.isFunction(e)&&e(a.data)})}function j(a,b,c,d,e,i,j){i(j,function(i){console.log("- Update course registration request submitted - starting to poll for request status"),g.pollRegistrationRequestStatus(i.id).then(function(){switch(console.log("-- Stop polling - Success"),a){case f.waitlisted:h.updateWaitlistedCourse(b,c);break;case f.registered:h.updateRegisteredCourse(b,c)}angular.isFunction(d)&&d()},function(a){console.log("-- Stop polling - Error",a),angular.isFunction(e)&&e(a.responseItemResults[0].messages[0])},function(){console.log("-- Continue polling")})},function(a){console.log("- Update course registration request failed",a),angular.isFunction(e)&&e(a.data)})}a.getSchedules=h.getSchedule,a.registeredCredits=h.getRegisteredCredits,a.registeredCourseCount=h.getRegisteredCourseCount,a.waitlistedCredits=h.getWaitlistedCredits,a.waitlistedCourseCount=h.getWaitlistedCourseCount,a.userId=h.getUserId,a.courseTypes=f;var k=0,l=0;a.showWaitlist=function(){return a.waitlistedCredits()>0||k>0},a.showSchedule=function(){return a.showWaitlist()||a.registeredCredits()>0||l>0},a.showGrid=function(){var a=!1;return angular.forEach(h.getCartCourses(),function(b){angular.forEach(b.schedule,function(b){if(!a)for(var c=b.activityOfferingLocationTime,d=0;d<c.length;d++)if(!c[d].isTBA){a=!0;break}})}),a||angular.forEach(h.getScheduledCourses(),function(b){angular.forEach(b.activityOfferings,function(b){if(!a)for(var c=b.scheduleComponents,d=0;d<c.length;d++)if(!c[d].isTBA){a=!0;break}})}),a},a.$on("courseStatusMessageRemoved",function(a,b){switch(b){case f.waitlisted:k--;break;case f.registered:l--}}),a.$on("dropCourse",function(a,b,c,d,e){switch(b){case f.waitlisted:console.log("Drop waitlisted course"),i(b,c,d,e,g.dropFromWaitlist().query,{masterLprId:c.masterLprId});break;case f.registered:console.log("Drop registered course"),i(b,c,d,e,g.dropRegistrationGroup().query,{masterLprId:c.masterLprId})}}),a.$on("updateCourse",function(b,c,d,e,h,i){switch(c){case f.waitlisted:console.log("Update waitlisted course"),j(c,d,e,h,i,g.updateWaitlistItem().query,{courseCode:d.courseCode,regGroupId:d.regGroupId,regGroupCode:d.regGroupCode,masterLprId:d.masterLprId,termId:a.termId,credits:e.credits,gradingOptionId:e.gradingOptionId});break;case f.registered:console.log("Update registered course"),j(c,d,e,h,i,g.updateScheduleItem().query,{courseCode:d.courseCode,regGroupId:d.regGroupId,regGroupCode:d.regGroupCode,masterLprId:d.masterLprId,termId:a.termId,credits:e.credits,gradingOptionId:e.gradingOptionId})}})}]),angular.module("regCartApp").controller("SearchCtrl",["$scope","$filter","SearchService","SEARCH_FACETS",function(a,b,c,d){function e(){var c=b("facetFilter"),d=[];angular.forEach(a.searchResults,function(b){c(b,a.facets)&&d.push(b)}),a.filteredResults=d}function f(b){if(null!==b&&(null===a.searchCriteria||b!==a.searchCriteria)){if(angular.isFunction(g)&&(g(),g=null),!a.termId)return console.log("Search blocked - no termId exists"),void(g=a.$on("termIdChanged",function(){g(),g=null,f(b)}));console.log('Searching for "'+b+'"'),h=b,c.searchForCourses().query({termId:a.termId,criteria:b},function(c){h===b?(console.log('Search for "'+b+'" complete. Results: '+c.length),a.searchResults=c,a.searchCriteria=b,e()):console.log('Search completed but not the most recent, ignoring results: "'+b+'" !== "'+h+'"')},function(a){console.log("Error searching for courses: ",a)})}}a.facets=d,a.searchCriteria=null,a.searchResults=[],a.filteredResults=[],a.$on("termIdChanged",function(){var b=a.searchCriteria;a.searchCriteria="",a.searchResults=[],b&&f(b)}),a.$on("$stateChangeSuccess",function(a,b,c){console.log(c),angular.isDefined(c.searchCriteria)&&f(c.searchCriteria)}),a.$watch("facets",e,!0);var g,h=""}]).filter("startFrom",function(){return function(a,b){return b=+b,a.slice(b)}}).filter("facetFilter",function(){return function(a,b){var c=!0;return angular.forEach(b,function(b){c&&angular.isArray(b.selectedOptions)&&b.selectedOptions.length>0&&(b.filter(a,b.selectedOptions)||(c=!1))}),c}}),angular.module("regCartApp").controller("SearchDetailsCtrl",["$scope","$rootScope","$state","$filter","SearchService",function(a,b,c,d,e){function f(b){null===b||null!==a.course&&null!==a.course.courseId&&b===a.course.courseId||(console.log('Loading course "'+b+'"'),h=b,e.getCourse().query({courseOfferingId:b},function(c){h===b?(angular.isDefined(c.activityOfferingTypes)&&angular.isArray(c.activityOfferingTypes)&&angular.forEach(c.activityOfferingTypes,function(a){angular.forEach(a.activityOfferings,function(b){b.activityOfferingType=a.activityOfferingType})}),a.course=c):console.log('Course load completed but not the most recent, ignoring: "'+b+'" !== "'+h+'"')},function(a){console.log("Error loading course: ",a)}))}function g(b){"object"==typeof b&&angular.isDefined(b.activityOfferingType)&&(b=b.activityOfferingType);var c=null;return angular.forEach(a.selectedAOs,function(a){null===c&&a.activityOfferingType===b&&(c=a)}),c}a.searchCriteria=null,a.course=null,a.$on("termIdChanged",function(b,d,e){null!==e&&a.searchCriteria&&"root.search.details"===a.uiState&&c.goToPage("root.search.results",{searchCriteria:a.searchCriteria})}),a.$on("$stateChangeSuccess",function(b,c,d){angular.isDefined(d.searchCriteria)&&(a.searchCriteria=d.searchCriteria),angular.isDefined(d.id)&&f(d.id)});var h=null;a.selectedAOs=[],a.selectedRegGroup=null,a.selectedRegGroupId=null,a.selectedRegGroupCode=null,a.$watchCollection("selectedAOs",function(){}),a.clearSelectedAOs=function(){a.selectedRegGroup=null,a.selectedRegGroupId=null,a.selectedRegGroupCode=null,angular.forEach(a.selectedAOs,function(a){a.selected=!1}),a.selectedAOs=[],a.$broadcast("clearSelected")},a.addRegGroupIdToCart=function(){b.$broadcast("addRegGroupIdToCart",a.selectedRegGroupId)},a.hasSelectedAOs=function(){return a.selectedAOs.length>0},a.isAOSelected=function(b){return-1!==a.selectedAOs.indexOf(b)},a.isAOTypeSelected=function(a){var b=g(a);return null!==b},a.$on("toggleAO",function(b,c){a.toggleAO(c.ao.activityOfferingType,c.ao,a.course)}),a.toggleAO=function(b,c,d){if(a.selectedRegGroup=null,a.selectedRegGroupId=null,a.selectedRegGroupCode=null,a.isAOSelected(c))a.selectedAOs.splice(a.selectedAOs.indexOf(c),1),0===a.selectedAOs.length&&a.$broadcast("showAllRows");else{if(a.isAOTypeSelected(b)){var e=g(b);a.selectedAOs.splice(a.selectedAOs.indexOf(e),1)}a.selectedAOs.push(c),angular.forEach(d.activityOfferingTypes,function(d){d.activityOfferingType===b&&angular.forEach(d.activityOfferings,function(b){b!==c&&a.$broadcast("hideRow",b.activityOfferingId)})})}if(angular.forEach(d.activityOfferingTypes,function(b){a.isAOTypeSelected(b)||angular.forEach(b.activityOfferings,function(b){0==b.isSameRegGroup;for(var c in b.regGroupInfos){var d=0;if(angular.forEach(a.selectedAOs,function(e){for(var f in e.regGroupInfos){if(c==f&&(0==d||d>0&&1==b.isSameRegGroup)){b.isSameRegGroup=!0,a.$broadcast("showRow",b.activityOfferingId);break}b.isSameRegGroup=!1,a.$broadcast("hideRow",b.activityOfferingId)}d++}),1==b.isSameRegGroup)break}})}),a.selectedAOs.length==d.activityOfferingTypes.length){var f={},h=0;angular.forEach(a.selectedAOs,function(b){var c=0;for(var d in b.regGroupInfos)c++;if(1!=c||0!=h&&a.selectedRegGroup===!0){if(1!==c&&a.selectedRegGroup!==!0){if(0==h)for(var d in b.regGroupInfos)f[d]=b.regGroupInfos[d];else for(var e in f){var g=!1;for(var d in b.regGroupInfos)if(e==d){g=!0;break}g||delete f[e]}var i=0;for(var d in f)i++;if(1==i)for(var e in f)a.selectedRegGroup=!0,a.selectedRegGroupId=e,a.selectedRegGroupCode=f[e]}}else for(var d in b.regGroupInfos)a.selectedRegGroup=!0,a.selectedRegGroupId=d,a.selectedRegGroupCode=b.regGroupInfos[d];h++})}},a.aoFilter=function(b,c){return c||a.isAOSelected(b)?!0:!a.isAOTypeSelected(b.activityOfferingType)}}]),angular.module("regCartApp").filter("creditRangeFormatter",function(){return function(a){var b="";if(a&&angular.isArray(a)){if(1===a.length)b=parseFloat(a[0]);else{var c=parseFloat(Math.min.apply(null,a)),d=parseFloat(Math.max.apply(null,a));b=c+"-"+d}b+=" cr"}return b}}).filter("aoFormatter",function(){return function(a){var b=[];return angular.forEach(a,function(a){var c=a.scheduleComponents,d=a.instructors,e="",f="",g="",h="",i="";if(c&&angular.isArray(c))for(var j=0;j<c.length;j++)e+=denullify(c[j].days),f+=denullify(c[j].displayTime),g+=denullify(c[j].buildingCode)+" "+denullify(c[j].roomCode),j<c.length-1&&(e+="<br />",f+="<br />",g+="<br />");if(d&&angular.isArray(d))for(var k=0;k<d.length;k++)h+=denullify(d[k].firstName)+" "+denullify(d[k].lastName),k<d.length-1&&(h+="<br />");i+=a.seatsOpen+"/"+a.seatsAvailable,0===a.seatsOpen&&(i='<span class="kscr-Search-results-no-seats">'+i+"</span>"),i='<span class="kscr-Search-result-hidden">'+zeroPad(a.seatsOpen)+zeroPad(a.seatsAvailable)+"</span>"+i;var l={days:e,time:f,instructor:h,location:g,seatsOpen:i,aoId:a.activityOfferingId,ao:a};b.push(l)}),b}}),angular.module("regCartApp").filter("formatValidationMessage",["VALIDATION_ERROR_TYPE","MessageService",function(a,b){function c(a,b,c){var d=e(a.messageKey,c),f=[];if(a.courseCode&&f.push({masterLprId:a.masterLprId,courseCode:a.courseCode}),a.conflictingCourses&&angular.forEach(a.conflictingCourses,function(a){f.push(a)}),f.length){var g=null,h=[],i=[];b&&(angular.isDefined(b.cartItemId)?g=b.cartItemId:angular.isDefined(b.masterLprId)&&(g=b.masterLprId));for(var j=0;j<f.length;j++){if(f[j].masterLprId){if(f[j].masterLprId===g||i.indexOf(f[j].masterLprId)>=0)continue;i.push(f[j].masterLprId)}f[j].courseCode&&h.push("<strong>"+f[j].courseCode+"</strong>")}h.length&&(d+=" ("+h.join(", ")+")")}return d}function d(a,b){var c=e(a.messageKey,b);if(a.maxCredits){var d=parseFloat(a.maxCredits);c+=" (<strong>"+d+" credits</strong>)"}return c}function e(a,c){return b.getMessage(c,a)}return function(b,f,g){var h="";if(b)if("string"==typeof b)"string"==typeof f&&""!==b&&-1!==b.indexOf(f)&&(b=b.replace(f,"<strong>"+f+"</strong>")),h=b;else if(b.messageKey)switch(b.messageKey){case a.timeConflict:h=c(b,f,g);break;case a.maxCredits:h=d(b,g);break;default:h=e(b.messageKey,g)}return h}}]),angular.module("regCartApp").service("CartService",["$q","ServiceUtilities","URLS",function(a,b,c){var d={};this.getCart=function(b){var c=a.defer();return angular.isDefined(d[b])?c.resolve(d[b]):this.getCartFromServer().query({termId:b},function(a){d[b]=a,c.resolve(a)},function(a){c.reject(a)}),c.promise},this.getCartFromServer=function(){return b.getData(c.courseRegistrationCart+"/searchForCart")},this.addCourseToCart=function(){return b.postData(c.courseRegistrationCart+"/addCourseToCart")},this.removeItemFromCart=function(a){return b.deleteData(a)},this.invokeActionLink=function(a){return b.getData(a)},this.updateCartItem=function(){return b.putData(c.courseRegistrationCart+"/updateCartItem")},this.submitCart=function(){return b.getData(c.courseRegistrationCart+"/submitCart")},this.undoDeleteCourse=function(){return b.getData(c.courseRegistrationCart+"/undoDeleteCourse")}}]),angular.module("regCartApp").service("TermsService",["$q","ServiceUtilities","URLS","DEFAULT_TERM",function(a,b,c,d){var e=d;this.getTermId=function(){return e},this.setTermId=function(a){e=a},this.getTermNameForTermId=function(a,b){var c;return angular.forEach(a,function(a){a.termId===b&&(c=a.termName)}),c};var f=null;this.getTerms=function(){var b=a.defer();return null!==f?b.resolve(f):this.getTermsFromServer().query({termCode:null,active:!0},function(a){f=a,b.resolve(a)},function(a){b.reject(a)}),b.promise},this.checkStudentEligibilityForTerm=function(){return b.getData(c.scheduleOfClasses+"/checkStudentEligibilityForTerm")},this.getTermsFromServer=function(){return b.getArray(c.scheduleOfClasses+"/terms")}}]),angular.module("regCartApp").service("ScheduleService",["$q","$timeout","URLS","STATUS","ServiceUtilities","GlobalVarsService",function(a,b,c,d,e,f){var g={};this.getSchedule=function(b,c){var d=a.defer();return c||(c=!1),angular.isDefined(g[b])&&!c?d.resolve(g[b]):this.getScheduleFromServer().query({termId:b},function(a){g[b]=a,d.resolve(a)},function(a){d.reject(a)}),d.promise},this.pollRegistrationRequestStatus=function(c,e){angular.isNumber(e)||(e=1e3);var g=a.defer(),h=this;return b(function(){h.getRegistrationStatus().query({regReqId:c},function(a){var b=f.getCorrespondingStatusFromState(a.state);switch(b){case d.new:case d.processing:g.notify(a),h.pollRegistrationRequestStatus(c,e);break;case d.success:g.resolve(a);break;case d.error:g.reject(a)}},function(a){g.reject(a)})},e),g.promise},this.getScheduleFromServer=function(){return e.getData(c.courseRegistration+"/studentSchedule")},this.dropRegistrationGroup=function(){return e.deleteData(c.courseRegistration+"/registrationRequest")},this.registerForRegistrationGroup=function(){return e.postData(c.courseRegistration+"/registrationRequest")},this.updateScheduleItem=function(){return e.putData(c.courseRegistration+"/registrationRequest")},this.dropFromWaitlist=function(){return e.deleteData(c.courseRegistration+"/waitlistRegistrationRequest")},this.updateWaitlistItem=function(){return e.putData(c.courseRegistration+"/waitlistRegistrationRequest")},this.getRegistrationStatus=function(){return e.getData(c.courseRegistration+"/registrationStatus")}}]),angular.module("regCartApp").service("LoginService",["ServiceUtilities","URLS",function(a,b){this.logOnAsAdmin=function(){return a.getData(b.developmentLogin+"/login")},this.logout=function(){return a.getData(b.developmentLogin+"/logout")}}]),angular.module("regCartApp").service("MessageService",["$q","$resource",function(a,b){var c=null;this.getMessages=function(){var b=a.defer();return null!==c?b.resolve(c):this.loadMessages().query({},function(a){c=a,b.resolve(c)},function(a){b.reject(a)}),b.promise},this.getMessage=function(a,b){var c="";return angular.forEach(a,function(a){a.messageKey===b&&(c=a.message)}),c},this.loadMessages=function(){return b("json/messages.json",{},{query:{method:"GET",cache:!1,isArray:!0}})}}]),angular.module("regCartApp").service("SearchService",["ServiceUtilities","URLS",function(a,b){this.searchForCourses=function(){return a.getArray(b.scheduleOfClasses+"/search")},this.getCourse=function(){return a.getData(b.scheduleOfClasses+"/courseOfferingInfo")}}]),angular.module("regCartApp").factory("loginInterceptor",["$q","$injector","$window","$rootScope",function(a,b,c,d){return{response:function(b){var c=b.data;return"object"!=typeof c&&c.indexOf("Kuali Student Login")>-1?(console.log("Informing user that session has expired..."),d.$broadcast("sessionExpired"),a.reject(b)):b},responseError:function(d){if(0===d.status){console.log("Failed to execute request - trying to login");var e=b.get("LoginService");e.logOnAsAdmin().query({userId:"admin",password:"admin"},function(){console.log("Logged in, reloading page."),c.location.reload()},function(){console.log("Not Logged in, reloading page."),c.location.reload()})}return a.reject(d)}}}]),angular.module("regCartApp").service("GlobalVarsService",["STATE","STATUS",function(a,b){var c,d,e,f=0,g=0,h=0,i=0,j=0,k={},l=1,m=[],n=[],o=[];this.getCartCredits=function(){return f},this.setCartCredits=function(a){f=a},this.getCartCourseCount=function(){return g},this.setCartCourseCount=function(a){g=a},this.getRegisteredCredits=function(){return c},this.setRegisteredCredits=function(a){c=a},this.getRegisteredCourseCount=function(){return h},this.setRegisteredCourseCount=function(a){h=a},this.getWaitlistedCredits=function(){return i},this.setWaitlistedCredits=function(a){i=a},this.getWaitlistedCourseCount=function(){return j},this.setWaitlistedCourseCount=function(a){j=a},this.getCartCourses=function(){return m},this.setCartCourses=function(a){m.splice(0,m.length),a&&(angular.forEach(a,function(a){m.push(a)}),this.setCartCourseCount(a.length))},this.getRegisteredCourses=function(){return n},this.getWaitlistedCourses=function(){return o},this.getScheduledCourses=function(){return n.concat(o)},this.removeRegisteredCourse=function(a){this.getRegisteredCourses().splice(this.getRegisteredCourses().indexOf(a),1),this.setRegisteredCredits(parseFloat(this.getRegisteredCredits())-parseFloat(a.credits)),this.setRegisteredCourseCount(parseInt(this.getRegisteredCourseCount())-1)},this.removeWaitlistedCourse=function(a){this.getWaitlistedCourses().splice(this.getWaitlistedCourses().indexOf(a),1),this.setWaitlistedCredits(parseFloat(this.getWaitlistedCredits())-parseFloat(a.credits)),this.setWaitlistedCourseCount(this.getWaitlistedCourses().length)},this.updateRegisteredCourse=function(a,b){var c=parseFloat(this.getRegisteredCredits())-parseFloat(a.credits)+parseFloat(b.credits);console.log("registeredCredits = "+c),this.setRegisteredCredits(c)},this.updateWaitlistedCourse=function(a,b){var c=parseFloat(this.getWaitlistedCredits())-parseFloat(a.credits)+parseFloat(b.credits);console.log("waitlistedCredits = "+c),this.setWaitlistedCredits(c)},this.getSchedule=function(){return d},this.setSchedule=function(a){d=a},this.getUserId=function(){return e},this.setUserId=function(a){e=a},this.getCorrespondingStatusFromState=function(c){var d=b.new;return a.processing.indexOf(c)>=0?d=b.processing:a.success.indexOf(c)>=0?d=b.success:a.error.indexOf(c)>=0?d=b.error:a.waitlist.indexOf(c)>=0?d=b.waitlist:a.action.indexOf(c)>=0&&(d=b.action),d
},this.updateScheduleCounts=function(a){var b=a.studentScheduleTermResults,c=a.userId,d=0,e=0;n.splice(0,n.length),o.splice(0,o.length),this.setSchedule(b),angular.forEach(b,function(a){angular.forEach(a.registeredCourseOfferings,function(a){d+=parseFloat(a.credits),n.push(a);var b=0;angular.forEach(a.gradingOptions,function(){b++}),a.gradingOptionCount=b}),angular.forEach(a.waitlistCourseOfferings,function(a){e+=parseFloat(a.credits),o.push(a);var b=0;angular.forEach(a.gradingOptions,function(){b++}),a.gradingOptionCount=b})}),this.setRegisteredCourseCount(n.length),this.setRegisteredCredits(d),this.setWaitlistedCredits(e),this.setWaitlistedCourseCount(o.length),this.setUserId(c)},this.getCorrespondingMessageFromStatus=function(a){var c="";return a===b.waitlist&&(c="If a seat becomes available you will be registered automatically"),c},this.getCourseIndex=function(a){var b=a.courseCode+(a.regGroup||a.regGroupCode),c=k[b];return isNaN(c)&&(c=l++,k[b]=c),c}}]),angular.module("regCartApp").service("ServiceUtilities",["$resource","APP_URL",function(a,b){function c(a){var b=[];for(var c in a)a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}this.getData=function(c){return a(b+c,{},{query:{method:"GET",cache:!1,isArray:!1}})},this.deleteData=function(c){return a(b+c,{},{query:{method:"DELETE",cache:!1,isArray:!1}})},this.postData=function(d){return a(b+d,{},{query:{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",cache:!1,isArray:!1,transformRequest:function(a){return c(a)}}})},this.putData=function(d){return a(b+d,{},{query:{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"PUT",cache:!1,isArray:!1,transformRequest:function(a){return c(a)}}})},this.getArray=function(c){return a(b+c,{},{query:{method:"GET",cache:!1,isArray:!0}})}}]),angular.module("regCartApp").service("CourseCalendarDataParser",["DAY_CONSTANTS","GlobalVarsService",function(a,b){function c(){var b={};return b[a.monday]=[],b[a.tuesday]=[],b[a.wednesday]=[],b[a.thursday]=[],b[a.friday]=[],b}function d(a,b,c){return angular.forEach(b,function(b){if(!b.dropped){var d={courseCode:b.courseCode,regGroup:b.regGroupCode};switch(c){case"CART":angular.forEach(b.schedule,function(b){angular.forEach(b.activityOfferingLocationTime,function(b){var f=b.time;a=e(a,d,f,c)})});break;default:angular.forEach(b.activityOfferings,function(b){angular.forEach(b.scheduleComponents,function(b){a=e(a,d,b,c)})})}}}),a}function e(b,c,d,e){return d.isTBA||angular.forEach(a.dayArray,function(a){d.days.indexOf(a)>-1&&(b=f(b,c,d,a,e))}),b}function f(b,c,d,e,f){if(!d.startTime||!d.endTime)return b;angular.isArray(b[e])||(b[e]=[],e!==a.saturday||angular.isArray(b[a.sunday])||(b[a.sunday]=[]),e!==a.sunday||angular.isArray(b[a.saturday])||(b[a.saturday]=[]));var g=j(d.startTime),h=j(d.endTime);g>h&&(h+=1440);var i={index:k(c),courseCode:c.courseCode,startTime:g,endTime:h,type:f};return b[e].push(i),b}function g(b){var c=["REG","WAIT","CART"],d=[],e=null,f=null,g=60;return angular.forEach(a.dayArray,function(a){var i=b[a];if(angular.isArray(i)){var j=[],k={};angular.forEach(i,function(a){var b=a.type;angular.isArray(k[b])||(k[b]=[]),k[b].push(a),(null===e||a.startTime-g<e)&&(e=a.startTime-g),(null===f||a.endTime+g>f)&&(f=a.endTime+g)}),angular.forEach(c,function(a){var b=k[a];angular.forEach(b,function(a){j=h(j,a)})});var l={day:a,rows:j};d.push(l)}}),0>e&&(e=0),{timeRange:[e,f],days:d}}function h(a,b){for(var c=!1,d=function(a,b){return a.startTime===b.startTime?0:a.startTime<b.startTime?-1:1},e=0;e<a.length;e++){var f=a[e],g=f.courses;angular.isArray(g)||(g=[]);var h=i(g,b);if(!h){g.push(b),g.sort(d),c=!0;break}}if(!c){var j=[];j.push(b),a.push({courses:j})}return a}function i(a,b){for(var c=!1,d=b.startTime,e=b.endTime,f=0;f<a.length;f++){var g=a[f],h=g.startTime,i=g.endTime;if(i>=d&&e>=h){angular.isArray(b.conflicts)||(b.conflicts=[]),angular.isArray(g.conflicts)||(g.conflicts=[]),b.conflicts.push(g.index),g.conflicts.push(b.index),c=!0;break}}return c}function j(a){var b=a.indexOf(":"),c=a.substring(0,b),d=a.substring(b+1,a.indexOf(" ")),e=-1!==a.toLowerCase().indexOf("pm"),f=60*parseInt(c);return f+=parseInt(d),e&&"12"!==c&&(f+=720),f}function k(a){return b.getCourseIndex(a)}this.buildCalendar=function(a,b,e){var f=c();return a&&(f=d(f,a,"REG")),b&&(f=d(f,b,"WAIT")),e&&(f=d(f,e,"CART")),g(f)}}]),angular.module("regCartApp").directive("courseCalendar",function(){return{restrict:"E",templateUrl:"partials/courseCalendar.html",controller:["$scope","CourseCalendarDataParser","GlobalVarsService",function(a,b,c){a.courseFilter=function(b){var c=!0;switch(b.type){case"REG":c=!a.hideRegistered;break;case"WAIT":c=!a.hideWaitlisted;break;case"CART":c=!a.hideCart}return c},a.timeFilter=function(b){var c=b.getHours();return a.visibleTimeRange[0]/60<=c&&c<=a.visibleTimeRange[1]/60},a.hideRegistered=!1,a.hideWaitlisted=!1,a.hideCart=!1,a.visibleTimeRange=[],a.times=[];for(var d=0;24>d;d++)a.times.push(new Date(0,0,0,d,0,0,0));a.registered=c.getRegisteredCourses(),a.waitlisted=c.getWaitlistedCourses(),a.cart=c.getCartCourses();var e=function(c){if(c){var d=b.buildCalendar(a.registered,a.waitlisted,a.cart);a.visibleTimeRange=[60*Math.floor(d.timeRange[0]/60),60*Math.ceil(d.timeRange[1]/60)],a.days=d.days}};e(!0),a.$watchCollection("registered",e),a.$watchCollection("waitlisted",e),a.$watchCollection("cart",e)}]}}),angular.module("regCartApp").directive("courseCalendarItem",["$timeout",function(a){return{restrict:"CAE",link:function(b,c){a(function(){var a=b.visibleTimeRange,d=c.parent(),e=c[0].offsetHeight,f=a[1]-a[0],g=b.course.endTime-b.course.startTime,h=100*g/f,i=100*(b.course.startTime-a[0])/f;c.css({left:i+"%",width:h+"%"}),d.height()<e&&d.height(e)})}}}]),angular.module("regCartApp").directive("courseCard",function(){return{transclude:!0,scope:{schedules:"=",credits:"=",type:"@"},templateUrl:"partials/courseCard.html",controller:"CardCtrl"}}).directive("courseAccordion",function(){return{restrict:"E",transclude:!0,scope:{course:"=",type:"@",cardIndex:"=",cartId:"="},templateUrl:"partials/courseAccordion.html",controller:"CardCtrl"}}).controller("CardCtrl",["$scope","$timeout","GlobalVarsService","TermsService","CartService","ScheduleService","STATUS","GRADING_OPTION","COURSE_TYPES",function(a,b,c,d,e,f,g,h,i){function j(){var b;switch(a.type){case i.waitlisted:b={heading:"Waitlisted",prefix:"waitlisted",prefix2:"waitlist_",prefix3:"waitlist_",remove:"Remove"};break;case i.cart:b={heading:"Cart",prefix:"cart",prefix2:"",prefix3:"cart_",remove:"Remove"};break;default:b={heading:"Registered",prefix:"reg",prefix2:"",prefix3:"schedule_",remove:"Drop"}}return b}function k(a){return a.credits=a.newCredits,a.gradingOptionId=a.newGrading,a}function l(a){var c=angular.copy(a);k(a),a.editing=!1,a.isopen=!1,a.gradingOptionId!==c.gradingOptionId&&(a.editGradingOption=!0,b(function(){a.editGradingOption=!1},2e3)),a.credits!==c.credits&&(a.editCredits=!0,b(function(){a.editCredits=!1},2e3))}a.config=j(),a.courseTypes=i,a.courseOfferings=function(b){var c;switch(a.type){case i.waitlisted:c=b.waitlistCourseOfferings;break;default:c=b.registeredCourseOfferings}return c},a.cancelDropConfirmation=function(a){a.dropping=!1},a.showBadge=function(a){return a.gradingOptionId!==h.letter||a.editGradingOption},a.editItem=function(a){a.newCredits=a.credits,a.newGrading=a.gradingOptionId,a.editing=!0},a.gradingOption=function(b){return b.gradingOptions[a.course.gradingOptionId]},a.courseIndex=function(a){return angular.isDefined(a.index)&&a.index||(a.index=c.getCourseIndex(a)),a.index},a.removeStatusMessage=function(b){b.statusMessage=null,a.$emit("courseStatusMessageRemoved",a.type,b)},a.dropCourse=function(b){switch(a.type){case i.cart:a.$emit("deleteCartItem",b);break;default:console.log("Open drop confirmation"),b.dropping=!0}},a.dropCourseConfirmed=function(b){b.dropping=!1,b.dropProcessing=!0,b.statusMessage={txt:"<strong>"+b.courseCode+" ("+b.regGroupCode+")</strong> drop processing",type:g.processing},a.$emit("dropCourse",a.type,b,function(){b.dropped=!0,b.dropProcessing=!1;var c;switch(a.type){case i.registered:c="<strong>"+b.courseCode+" ("+b.regGroupCode+")</strong> dropped successfully";break;case i.waitlisted:c="Removed from waitlist for <strong>"+b.courseCode+" ("+b.regGroupCode+")</strong> successfully"}b.statusMessage={txt:c,type:g.success}},function(a){b.dropProcessing=!1,b.statusMessage={txt:a,type:g.error}})},a.updateItem=function(b){console.log("Updating "+a.type+" course. Grading: "+b.newGrading+", Credits: "+b.newCredits),b.requestProcessing=!0;var c=angular.copy(b);k(c),a.$emit("updateCourse",a.type,b,c,function(){b.requestProcessing=!1,l(b)},function(a){b.requestProcessing=!1,b.statusMessage={txt:a,type:g.error}})}}]),angular.module("regCartApp").directive("courseOptions",function(){return{restrict:"E",transclude:!0,scope:{course:"=",maxOptions:"@max",prefix:"@",showAll:"@",moreButtonSelectBehavior:"@moreBehavior",cancelFn:"&onCancel",submitFn:"&onSubmit"},templateUrl:"partials/courseOptions.html",controller:["$scope","$modal",function(a,b){function c(a,b,c){if(a.length<=g)return!0;var d=a.indexOf(b),e=a.indexOf(c),f=2,h=Math.max(0,Math.min(d-f,a.length-g)),i=Math.min(h+g,a.length)-1;return e>=h&&i>=e}function d(){var c=a.$new();c.course=angular.copy(f),c.cancel=function(){},c.submit=function(){},f.editing=!1;var d=b.open({backdrop:"static",template:'<div class="kscr-AdditionalOptions"><course-options course="course" show-all="true" max="'+g+'" prefix="modal_'+(a.prefix?a.prefix:"")+'" on-submit="modalSubmit()" on-cancel="modalCancel()"></course-options></div>',scope:c,controller:["$scope",function(a){a.showAllCreditOptions=!0,a.showAllGradingOptions=!0,a.modalCancel=function(){a.$dismiss("cancel")},a.modalSubmit=function(){a.$close(a.course)}}]});d.result.then(function(b){f.newGrading=b.newGrading,f.newCredits=b.newCredits,a.submit()},function(){a.cancel()})}function e(){a.showAllCreditOptions=h,a.showAllGradingOptions=h}var f=a.course,g=a.maxOptions||4,h=a.showAll?!0:!1,i=a.moreButtonSelectBehavior||"expand";a.showAllCreditOptions=h,a.showAllGradingOptions=h,a.gradingOptions=[],f&&f.gradingOptions&&angular.forEach(f.gradingOptions,function(a,b){this.push({key:b,label:a})},a.gradingOptions),a.creditOptionsFilter=function(b){return!f||a.showAllCreditOptions?!0:c(f.creditOptions,f.credits,b)},a.gradingOptionsFilter=function(b){return!f||a.showAllGradingOptions?!0:c(Object.keys(f.gradingOptions),f.grading,b.key)},a.showMoreCreditOptions=function(){"expand"===i?a.showAllCreditOptions=!0:d()},a.showMoreGradingOptions=function(){"expand"===i?a.showAllGradingOptions=!0:d()},a.shouldShowMoreCreditOptionsToggle=function(){return!a.showAllCreditOptions&&f.creditOptions.length>g},a.shouldShowMoreGradingOptionsToggle=function(){return!a.showAllGradingOptions&&Object.keys(f.gradingOptions).length>g},a.cancel=function(){console.log("Canceling options changes"),f.newCredits=f.credits,f.newGrading=f.grading||f.gradingOptionId,f.status="",f.editing=!1,a.cancelFn&&a.cancelFn({course:f}),e()},a.submit=function(){console.log("Submitting options form"),a.submitFn&&a.submitFn({course:f}),e()},a.showGradingHelp=function(){b.open({templateUrl:"partials/gradingOptionsHelp.html"})}}]}}),angular.module("regCartApp").directive("focusMe",["$timeout","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.focusMe);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})}),d.bind("blur",function(){a(function(){d[0].focus()})})}}}]).directive("focusOnce",["$timeout","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.focusOnce);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})})}}}]).directive("dropMenu",["$window",function(a){return{controller:["$scope",function(b){return angular.element(a).bind("resize",function(){b.dropMenu===!0&&(b.dropMenu=!1)})}],templateUrl:"dropMenu.html"}}]),angular.module("regCartApp").directive("maskScreen",["$timeout","$document",function(a,b){return{restrict:"A",scope:{maskScreen:"="},link:function(c,d){function e(){if(!i){g||(g=angular.element('<div class="util-Mask"/>'),g.bind("click",function(){f()})),b.find("body").append(g);var a=g.css("zIndex");h=d.css("zIndex"),d.css("zIndex",a+1),i=!0}}function f(){g&&(g.remove(),g=null),d.css("zIndex",h),i=!1,a(function(){c.maskScreen=i})}var g,h,i=!1;c.$watch("maskScreen",function(a){a&&!i?e():!a&&i&&f()}),c.mask&&!i&&e(),d.bind("$destroy",f)}}}]),angular.module("regCartApp").directive("searchFacet",[function(){return{restrict:"ECA",scope:{facet:"=",results:"="},templateUrl:"partials/searchFacet.html",controller:["$scope",function(a){function b(b,c){return angular.forEach(b,function(a){a.count=0}),angular.forEach(c,function(c){angular.forEach(b,function(b){a.facet.filter(c,b.value)&&b.count++})}),b}function c(c){angular.isFunction(a.facet.prepare)&&a.facet.prepare(c);var d=a.facet.optionsProvider(c);return angular.isFunction(a.facet.refine)&&(d=a.facet.refine(d,c),d=b(d,c)),d}function d(b){a.clearSelectedOptions();var d=c(b);a.options=d,angular.isDefined(a.facet.autoCollapse)&&!a.facet.autoCollapse||1!==d.length||(a.isCollapsed=!0)}angular.isFunction(a.facet.optionsProvider)||(a.facet.optionsProvider=function(b){var c=[];return angular.isDefined(a.facet.optionsKey)&&null!==a.facet.optionsKey?angular.forEach(b,function(b){if(angular.isDefined(b[a.facet.optionsKey])){var d=b[a.facet.optionsKey];angular.isArray(d)||(d=[d]),angular.forEach(d,function(a){var b=null;angular.forEach(c,function(c){null===b&&c.value===a&&(b=c)}),null===b&&(b={label:a,value:a,count:0},c.push(b)),b.count++})}}):console.log('Facet "'+a.facet.id+'" is missing the required optionsKey value'),c.sort(function(a,b){return a.label===b.label?0:a.label<b.label?-1:1}),c}),angular.isFunction(a.facet.filter)||(a.facet.filter=function(b,c){function d(a,b){var c=!1;return angular.isArray(a)?angular.forEach(a,function(a){c||(c=d(a,b))}):angular.isArray(b)?angular.forEach(b,function(b){c||(c=d(a,b))}):c=a===b,c}if(angular.isDefined(a.facet.optionsKey)&&null!==a.facet.optionsKey&&angular.isDefined(b[a.facet.optionsKey])){var e=b[a.facet.optionsKey];return d(e,c)}return!1}),a.options=[],a.facet.selectedOptions=[],a.$watch("results",function(a){d(a)}),a.clearSelectedOptions=function(){a.facet.selectedOptions=[]},a.hasSelected=function(){return a.facet.selectedOptions.length>0},a.isSelected=function(b){return-1!==a.facet.selectedOptions.indexOf(b.value)},a.toggleOption=function(b){var c=a.facet.selectedOptions.indexOf(b.value);-1===c?a.facet.selectedOptions.push(b.value):a.facet.selectedOptions.splice(c,1)}}]}}]),angular.module("regCartApp").directive("searchForm",[function(){return{restrict:"ECA",templateUrl:"partials/searchForm.html",controller:["$scope","$state",function(a,b){function c(){var a=null;return angular.isDefined(b.params)&&angular.isDefined(b.params.searchCriteria)&&(a=b.params.searchCriteria),a}function d(){var d=c();null!==d?d!==a.courseSearchCriteria&&(a.courseSearchCriteria=b.params.searchCriteria):a.courseSearchCriteria=""}a.courseSearchCriteria="",d(),a.$on("$stateChangeSuccess",function(){d()}),a.submit=function(){c()!==a.courseSearchCriteria&&b.go("root.search.results",{searchCriteria:a.courseSearchCriteria})}}]}}]),angular.module("regCartApp").directive("searchList",["$filter","$state",function(a,b){return{restrict:"E",require:"^searchResults",templateUrl:"partials/searchList.html",scope:{searchResults:"=?",searchColumns:"=",searchData:"=?",displayLimit:"=?",searchCriteria:"@",termName:"@",detailsId:"@",defaultField:"@",preprocessor:"@",onClick:"@"},link:function(c){angular.isUndefined(c.searchResults)&&(c.searchResults=a(c.preprocessor)(c.searchData)),c.displayLimits=[20,50,100],angular.isUndefined(c.displayLimit)&&(c.displayLimit=c.displayLimits[0]),c.page=1,c.detailsId={},c.reverseMap={},c.lastPage=function(){return Math.ceil(c.searchResults.length/c.displayLimit)},c.pageRange=function(){for(var a=[],b=c.lastPage(),d=1;b>=d;d++)a.push(d);return a},c.$watch("displayLimit",function(){c.page=1}),c.$watch("searchResults",function(){c.page>c.lastPage()&&(c.page=1)}),c.displayRangeMin=function(){return(c.page-1)*c.displayLimit+1},c.displayRangeMax=function(){var a=c.displayRangeMin(),b=a+c.displayLimit-1;return b>c.searchResults.length&&(b=c.searchResults.length),b},c.applyFilter=function(b,c){return angular.isArray(b)&&c?a(c)(b):b},c.getId=function(a){return a[c.detailsId]},c.sortResults=function(a){var b;switch(angular.isUndefined(c.reverseMap[a])&&(c.reverseMap[a]=0),c.reverseMap[a]){case 0:c.reverseMap[a]=1,b=!1;break;case 1:c.reverseMap[a]=2,b=!0;break;case 2:c.reverseMap[a]=0,c.predicate=void 0}return b},c.select=function(a,b){b.selected=!b.selected,c.$emit(a,b)},c.viewDetails=function(a,c){b.go("root.search.details",{searchCriteria:a,id:c})},c.hasData=function(a){for(var b=!1,d=0;d<c.searchResults.length;d++)if(c.searchResults[d][a]){b=!0;break}return b},c.$on("clearSelected",function(){angular.forEach(c.searchResults,function(a){a.selected=!1,a.hidden=!1})}),c.$on("hideRow",function(a,b){angular.forEach(c.searchResults,function(a){a[c.defaultField]===b&&(a.hidden=!0)})}),c.$on("showRow",function(a,b){angular.forEach(c.searchResults,function(a){a[c.defaultField]===b&&(a.hidden=!1)})}),c.$on("showAllRows",function(){angular.forEach(c.searchResults,function(a){a.hidden&&(a.hidden=!1)})})}}}]).directive("searchResults",function(){return{restrict:"E",controller:"SearchResultsCtrl"}}).directive("searchColumn",function(){return{restrict:"E",require:"^searchResults",link:function(a,b,c){if(c.name||c.field||c.filter){angular.isArray(a.searchColumns)||(a.searchColumns=[]);var d={name:c.name,field:c.field,filter:c.filter,order:c.order,url:c.url,sortable:c.sortable,optional:c.optional,checkbox:c.checkbox};d.sortable="false"!==d.sortable,a.searchColumns.push(d),a.sortSearchColumns()}}}}).controller("SearchResultsCtrl",["$scope","$filter",function(a,b){a.sortSearchColumns=function(){a.searchColumns=b("orderBy")(a.searchColumns,"order")}}]),angular.module("regCartApp").directive("sticky",["$timeout","$window","$document",function(a,b,c){return{restrict:"CA",link:function(d,e){a(function(){function d(){l||(k=e.offset().top);var c=j.height()<=e.height(),h=(b.pageYOffset||j.scrollTop())-(j.clientTop||0),i=h>=k||c;!l&&i?f():l&&!i&&g(),l&&c&&a(d,500)}function f(){h||(h=angular.element('<div class="util-sticky-placeholder"/>')),h.css("height",e.outerHeight()+"px"),h.insertBefore(e),e.addClass("util-sticky--stuck"),l=!0}function g(){h&&(h.remove(),h=null),e.removeClass("util-sticky--stuck"),l=!1}var h,i=angular.element(b),j=angular.element(c),k=e.offset().top,l=!1;e.addClass("util-sticky"),i.on("scroll",d),i.on("resize",function(){a(d)}),e.on("resize",function(){console.log("element resized"),a(d)}),d(),e.bind("$destroy",function(){h&&(h.remove(),h=null)})})}}}]);
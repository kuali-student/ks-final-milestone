"use strict";angular.module("regCartApp",["configuration","ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){b.otherwise("/myCart");var d={templateUrl:"partials/cart.html",controller:"CartCtrl"},e={templateUrl:"partials/schedule.html",controller:"ScheduleCtrl"};a.state("root",{"abstract":!0,url:"?term",views:{root:{templateUrl:"partials/main.html",controller:"MainCtrl"}}}).state("root.schedule",{url:"/mySchedule",views:{"":e,mycart:d,schedule:e}}).state("root.cart",{url:"/myCart",views:{"":e,mycart:d,schedule:e}}).state("root.search",{url:"/search?page&displayLimit&predicate&reverse&filters",views:{"":{templateUrl:"partials/search.html"},mycart:d,schedule:e}}).state("root.search.results",{url:"/{searchCriteria}",views:{"":{templateUrl:"partials/searchResults.html",controller:"SearchCtrl"}}}).state("root.search.details",{url:"/{searchCriteria}/{id}",templateUrl:"partials/searchDetails.html",controller:"SearchDetailsCtrl"}),c.interceptors.push("loginInterceptor")}]),angular.module("configuration",[]).value("APP_URL","ks-with-rice-bundled-dev/services/").value("DEFAULT_TERM","kuali.atp.2012Fall").value("FEATURE_TOGGLES",{searchDetails:{directAddToWaitlist:!1}}),angular.module("regCartApp").constant("URLS",{scheduleOfClasses:"ScheduleOfClassesClientService",courseRegistration:"CourseRegistrationClientService",courseRegistrationCart:"CourseRegistrationCartClientService",developmentLogin:"DevelopmentLoginClientService"}).constant("STATE",function(){var a={failed:"kuali.lpr.trans.state.failed",processing:"kuali.lpr.trans.state.processing",succeeded:"kuali.lpr.trans.state.succeeded",item:{failed:"kuali.lpr.trans.item.state.failed",processing:"kuali.lpr.trans.item.state.processing",succeeded:"kuali.lpr.trans.item.state.succeeded",waitlist:"kuali.lpr.trans.item.state.waitlist",waitlistActionAvailable:"kuali.lpr.trans.item.state.waitlistActionAvailable"}};return{lpr:a,action:[a.item.waitlistActionAvailable],error:[a.failed,a.item.failed],processing:[a.processing,a.item.processing],success:[a.succeeded,a.item.succeeded],waitlist:[a.item.waitlist]}}()).constant("STATUS",{action:"action",editing:"editing",error:"error","new":"new",processing:"processing",success:"success",waitlist:"waitlist"}).constant("COURSE_TYPES",{registered:"registered",waitlisted:"waitlist",cart:"cart"}).constant("GRADING_OPTION",{audit:"kuali.resultComponent.grade.audit",letter:"kuali.resultComponent.grade.letter",passFail:"kuali.resultComponent.grade.passFail"}).constant("ACTION_LINK",{removeItemFromCart:"removeItemFromCart",undoDeleteCourse:"undoDeleteCourse"}).constant("VALIDATION_ERROR_TYPE",{maxCredits:"kuali.lpr.trans.message.credit.load.exceeded",timeConflict:"kuali.lpr.trans.message.time.conflict",waitlistAvailable:"kuali.lpr.trans.message.waitlist.available",waitlistWaitlisted:"kuali.lpr.trans.message.waitlist.waitlisted",waitlistFull:"kuali.lpr.trans.message.waitlist.full",waitlistNotOffered:"kuali.lpr.trans.message.waitlist.not.offered",transactionException:"kuali.lpr.trans.message.exception",transactionItemException:"kuali.lpr.trans.item.message.exception",courseNotOpen:"kuali.lpr.trans.message.course.not.open"}).constant("GENERAL_ERROR_TYPE",{noRegGroup:"noRegGroup",courseNotFound:"kuali.cr.cart.message.course.code.not.found"}).constant("VALIDATION_SUCCESS_TYPE",{waitlistStudentRemoved:"kuali.lpr.trans.message.waitlist.student.removed",waitlistUpdated:"kuali.lpr.trans.message.waitlist.options.updated",courseUpdated:"kuali.lpr.trans.message.course.updated",courseDropped:"kuali.lpr.trans.message.course.dropped",personRegistered:"kuali.lpr.trans.message.person.registered"}).constant("DAY_CONSTANTS",{monday:"M",tuesday:"Tu",wednesday:"W",thursday:"Th",friday:"F",saturday:"Sa",sunday:"Su",dayArray:["M","Tu","W","Th","F","Sa","Su"]}),angular.module("regCartApp").constant("COURSE_DETAILS",{tabs:[{id:"time",selected:!0,name:"Time",fields:["days","time"]},{id:"instr",selected:!1,name:"Instr",fields:["instructor"]},{id:"seatsLoc",selected:!1,name:"Loc/Seats",fields:["location","seatsOpen"],wide:!0}],selectedTab:"time",selectEvent:"toggleAO",fieldOptions:{time:{right:!0},instructor:{block:!0},seatsOpen:{right:!0,append:"&nbsp;available"}},icons:"additionalInfo",getSections:function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c].activity,e=!0,f=0;f<b.length;f++)if(b[f].header===d){e=!1,b[f].details.push(a[c]);break}if(e){var g={header:d,details:[]};g.details.push(a[c]),b.push(g)}}return b}}),angular.module("regCartApp").constant("COURSE_SEARCH_FACETS",[{label:"Seats",id:"seatsAvailable",autoCollapse:!1,optionsProvider:function(a){var b=0;angular.forEach(a,function(a){a.seatsAvailable>0&&b++});var c=[];return b>0&&c.push({label:"Seats available",value:"seatsAvailable",count:b}),c},filter:function(a){return a.seatsAvailable>0}},{label:"Credits",id:"creditOptions",optionsKey:"creditOptions",refine:function(a){var b=[];return angular.forEach(a,function(a){var c=Math.floor(a.value),d=c;c>6&&(c=6,d="6+");for(var e=null,f=0;f<b.length;f++)if(-1!==b[f].value.indexOf(c)){e=b[f];break}null===e?(a.label=d,a.count=0,a.value=[a.value],-1===a.value.indexOf(c)&&a.value.push(c),b.push(a)):(-1===e.value.indexOf(a.value)&&e.value.push(c),e.label=d)}),b}},{label:"Course Level",id:"courseLevel",optionsKey:"courseLevel"},{label:"Course Prefix",id:"coursePrefix",optionsKey:"coursePrefix"}]).factory("CourseSearchFacets",["COURSE_SEARCH_FACETS","SearchFacetService",function(a,b){return b.initFacets(a)}]),angular.module("regCartApp").controller("MainCtrl",["$scope","$location","$state","TermsService","ScheduleService","CartService","GlobalVarsService","APP_URL","DEFAULT_TERM","LoginService","MessageService","$modal",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,b){if(a&&(angular.isUndefined(c.params.term)||c.params.term!==a.termCode)){console.log("Persisting term in state: "+a.termCode);var d=angular.copy(c.params);d.term=a.termCode;var e={notify:!1};b&&(e.location="replace"),c.go(c.current.name,d,e).then(function(){o(a)})}}function n(){var b=null;angular.isDefined(c.params.term)&&(b=d.getTermByCode(c.params.term)),null===b?(b=a.term?a.term:d.getTermById(i),m(b,!0)):a.term!==b&&o(b)}function o(b){if(null!==b){var c=a.term?a.term.termId:null;console.log("Syncing with term: "+b.termId),d.setSelectedTerm(b),a.term=b,console.log("- Checking term eligibility"),d.isStudentEligibleForTerm(b).then(function(d,e){a.studentIsEligibleForTerm=d,a.studentIsEligibleForTerm?a.$broadcast("termIdChanged",b.termId,c):e&&g.setUserId(e.userId)},function(b){console.log("Error while checking if term is open for registration",b),a.studentIsEligibleForTerm=!1})}}console.log(">> MainCtrl"),a.appUrl=h.replace("/services/","/"),a.userId=g.getUserId,a.terms=[],a.term=d.getSelectedTerm(),a.studentIsEligibleForTerm=!0,d.getTerms().then(function(b){a.terms=b,n()}),a.$watch("term",function(a,b){a&&a!==b&&(console.log("Term Changed: "+a.termId+", was "+(b?b.termId:null)),m(a))}),a.$on("$stateChangeSuccess",function(){n()}),a.$on("termIdChanged",function(b,c){e.getSchedule(c).then(function(b){console.log("called rest service to get schedule data - in main.js"),e.updateScheduleCounts(b),a.cartCredits=f.getCartCredits,a.cartCourseCount=f.getCartCourseCount,a.registeredCredits=e.getRegisteredCredits,a.registeredCourseCount=e.getRegisteredCourseCount,a.waitlistedCredits=e.getWaitlistedCredits,a.waitlistedCourseCount=e.getWaitlistedCourseCount,a.userId=g.getUserId})}),a.logout=function(){j.logout().query({},function(){console.log("Logging out"),location.reload()})},a.goToPage=function(a){console.log("Navigating to page: "+a),b.url(a)},a.$on("sessionExpired",function(){console.log("Received event sessionExpired"),l.open({backdrop:"static",templateUrl:"sessionExpired.html",controller:"SessionCtrl",size:"sm"})}),a.$parent.uiState=c.current.name,a.$on("$stateChangeStart",function(b,c){a.$parent.uiState=c.name}),a.searchForm=function(){var a=!0;return"root.search.details"===c.current.name&&(a=!1),a}}]).controller("SessionCtrl",["$scope","LoginService",function(a,b){a.logout=function(){b.logout().query({},function(){console.log("Session expired...logging out"),location.reload()})}}]),angular.module("regCartApp").controller("CartCtrl",["$scope","$modal","$timeout","STATE","STATUS","GRADING_OPTION","ACTION_LINK","COURSE_TYPES","GENERAL_ERROR_TYPE","CartService","ScheduleService","MessageService","TermsService","GlobalVarsService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b){j.getCart(b).then(function(b){a.cart=b;var c=[],f=null;angular.forEach(a.cart.items,function(b){if(w(b),n.getCorrespondingStatusFromState(b.state)===e.processing){b.status=e.processing;var g=angular.copy(b);a.cartResults.items.push(g),a.cartResults.state=d.lpr.processing,a.cartResults.status=e.processing,f=b.cartId}else c.push(b)}),a.cart.items=c,null!==f&&q(f)})}function p(b,d,f){a.courseAdded=!1,b.courseCode&&(b.courseCode=b.courseCode.toUpperCase()),j.addCourseToCart().query({cartId:a.cart.cartId,termId:m.getTermId(),courseCode:b.courseCode||null,regGroupCode:b.regGroupCode||null,regGroupId:b.regGroupId||null,gradingOptionId:b.gradingOptionId||null,credits:b.credits||null},function(b){console.log("Searched for course: "+a.courseCode+" "+a.regCode+", Term: "+m.getTermId()),a.courseCode="",a.regCode="",w(b),a.cart.items.unshift(b),console.log("Started to glow..."),b.addingNewCartItem=!0,c(function(){b.addingNewCartItem=!1},2e3),a.courseAdded=!0,angular.isFunction(d)&&d(b)},function(c){var g;if(404===c.status){if(c.data.messageKey)switch(c.data.messageKey){case i.courseNotFound:g=c.data.courseCode+" does not exist for "+m.getSelectedTerm().termName;break;default:g=l.getMessage(c.data.messageKey)}else g=c.data;a.userMessage={txt:g,messageKey:i.noRegGroup,type:e.error,course:b.courseCode},a.courseAdded=!0,angular.isFunction(f)&&f(a.userMessage)}else 400===c.status?(v(c.data,function(a){p(a,d,f)}),a.courseAdded=!0):(console.log("Error with adding course",c.data.consoleMessage),g=c.data.genericMessage+" for "+m.getSelectedTerm().termName,a.userMessage={txt:g,messageKey:i.noRegGroup,type:c.data.type,detail:c.data.detailedMessage,course:b.courseCode+" ("+b.regGroupCode+")"},a.courseAdded=!0,angular.isFunction(f)&&f(a.userMessage))})}function q(b){k.pollRegistrationRequestStatus(b).then(function(b){console.log("- Stop polling - Success"),a.cart.state=b.state,a.cart.status="",a.cartResults.state=d.lpr.item.succeeded,angular.forEach(b.responseItemResults,function(b){angular.forEach(a.cartResults.items,function(a){if(a.cartItemId===b.registrationRequestItemId)switch(a.state=b.state,a.type=b.type,a.status=n.getCorrespondingStatusFromState(b.state),a.statusMessages=b.messages,a.status){case e.waitlist:case e.action:a.waitlistMessage=n.getCorrespondingMessageFromStatus(a.status)}})}),r(!0),u()},function(a){console.log("- Stop polling - Error: ",a)},function(b){console.log("- Continue polling"),a.cart.state=b.state})}function r(b){b&&(a.cartResults.successCount=0,a.cartResults.waitlistCount=0,a.cartResults.waitlistedCount=0,a.cartResults.errorCount=0);var c=0,d=0,f=0,g=0;angular.forEach(a.cartResults.items,function(a){switch(a.status){case e.success:c++;break;case e.waitlist:c++,f++;break;case e.action:d++;break;case e.error:g++}}),a.cartResults.successCount=c,a.cartResults.waitlistCount=d,a.cartResults.waitlistedCount=f,a.cartResults.errorCount=g}function s(){if(!a.cart)return 0;for(var b=0,c=0;c<a.cart.items.length;c++)b+=Number(a.cart.items[c].credits);return b}function t(a,b,c){return a.credits&&a.gradingOptionId?void k.registerForRegistrationGroup().query({courseCode:a.courseCode||null,regGroupId:a.regGroupId||null,gradingOption:a.gradingOptionId||null,credits:a.credits||null,allowWaitlist:a.allowWaitlist||!0},function(a){k.pollRegistrationRequestStatus(a.id).then(function(a){var e=null;angular.forEach(a.responseItemResults,function(a){null===e&&(e=a.state)}),e===d.lpr.item.failed?angular.isFunction(c)&&c(a):(u(),angular.isFunction(b)&&b(a))},c)},c):void v(a,function(d){a.gradingOptionId=d.gradingOptionId,a.credits=d.credits,t(a,b,c)})}function u(){k.getSchedule(m.getTermId(),!0).then(function(b){console.log("Called rest service to get schedule data - in cart.js"),k.updateScheduleCounts(b),a.registeredCredits=k.getRegisteredCredits,a.registeredCourseCount=k.getRegisteredCourseCount})}function v(a,c){b.open({backdrop:"static",templateUrl:"partials/additionalOptions.html",size:"sm",resolve:{item:function(){return a}},controller:["$scope","item",function(a,b){console.log("Controller for modal... Item: ",b);var d=null;angular.isDefined(b.gradingOptions[f.letter])?d=f.letter:angular.forEach(b.gradingOptions,function(a,b){null===d&&(d=b)}),b.gradingOptionId=b.newGrading=d,b.credits=b.newCredits=b.creditOptions[0],a.newCartItem=b,a.newCartItem.editing=!0,a.dismissAdditionalOptions=function(){console.log("Dismissing credits and grading"),a.$close(!0)};var e=!1;a.saveAdditionalOptions=function(b){e||(e=!0,b.editing=!1,a.newCartItem.credits=a.newCartItem.newCredits,a.newCartItem.gradingOptionId=a.newCartItem.newGrading,c(a.newCartItem),a.$close(!0))}}]})}function w(a){a.longName=a.courseTitle,a.gradingOptionId=a.grading}console.log(">> CartCtrl"),a.states=d,a.statuses=e,a.courseTypes=h,a.oneAtATime=!1,a.isCollapsed=!0,a.cartResults={items:[]},a.$on("termIdChanged",function(b,c){console.log("term id has changed - cart: "+c),a.cartResults.items.splice(0,a.cartResults.items.length),a.userMessage&&a.userMessage.txt&&a.removeUserMessage(),o(c)}),a.$watchCollection("cart.items",function(b){a.creditTotal=s(),b&&j.setCartCredits(a.creditTotal),j.setCartCourses(b)}),m.getTermId()&&o(m.getTermId()),a.courseIndex=function(a){return angular.isDefined(a.index)&&a.index||(a.index=n.getCourseIndex(a)),a.index},a.getStatusMessageFromStatus=function(a){var b="";return a===e.success?b=" - Success!":(a===e.error||a===e.action)&&(b=" - Failed"),b},a.addRegGroupToCart=function(){p({courseCode:a.courseCode,regGroupCode:a.regCode})},a.$on("addCourseToCart",function(a,b,c,d){p(b,c,d)}),a.$on("registerForCourse",function(a,b,c,d){t(b,c,d)}),a.addCartItemToCart=function(a){p(a)},a.cancelNewCartItem=function(){a.newCartItem=null,a.showNew=!1},a.$on("deleteCartItem",function(b,c){var d=c.actionLinks,f=null;angular.forEach(d,function(a){a.action===g.removeItemFromCart&&(f=a.uri)}),j.removeItemFromCart(f).query({},function(b){console.log("Cart item removed",b),a.cart.items.splice(a.cart.items.indexOf(c),1);var d=null;angular.forEach(b.actionLinks,function(a){a.action===g.undoDeleteCourse&&(d=a.uri)}),a.userMessage={txt:"Removed <b>"+c.courseCode+"("+c.regGroupCode+")</b>",actionLink:d,linkText:"Undo",type:e.success}})}),a.$on("updateCourse",function(b,c,d,e,f,g){c===h.cart&&(console.log("Updating cart item"),j.updateCartItem().query({cartId:a.cart.cartId,cartItemId:d.cartItemId,credits:e.credits,gradingOptionId:e.gradingOptionId},function(){console.log("- Cart item successfully updated"),angular.isFunction(f)&&f()},function(a){console.log("- Error updating cart item",a),angular.isFunction(g)&&g(a.genericMessage)}))}),a.invokeActionLink=function(b){j.invokeActionLink(b).query({},function(b){w(b),a.cart.items.unshift(b),a.removeUserMessage()})},a.addCartItemToWaitlist=function(a){console.log("Adding cart item to waitlist... "),k.registerForRegistrationGroup().query({courseCode:a.courseCode,regGroupId:a.regGroupId,gradingOption:a.gradingOptionId,credits:a.credits,allowWaitlist:!0},function(b){a.state=d.lpr.item.processing,a.status=e.processing,a.cartItemId=b.registrationRequestItems[0].id,c(function(){console.log("Just waited 250, now start the polling"),q(b.id)},250)})},a.removeAlertMessage=function(a){a.alertMessage=null},a.removeUserMessage=function(){a.userMessage&&(a.userMessage.txt=null,a.userMessage.linkText=null)},a.removeCartResultItem=function(b){a.cartResults.items.splice(b,1),r()},a.register=function(){j.submitCart().query({cartId:a.cart.cartId},function(b){console.log("Submitted cart. RegReqId["+b.id+"]"),a.removeUserMessage(),a.cartResults=angular.copy(a.cart),a.cart.items.splice(0,a.cart.items.length),a.showConfirmation=!1,a.cartResults.state=d.lpr.processing,a.cartResults.status=e.processing,a.creditTotal=0,angular.forEach(a.cartResults.items,function(a){a.state=d.lpr.item.processing,a.status=e.processing}),c(function(){console.log("Just waited 250, now start the polling"),q(b.id)},250)})}}]),angular.module("regCartApp").controller("ScheduleCtrl",["$scope","$modal","$timeout","STATUS","GRADING_OPTION","COURSE_TYPES","ScheduleService","CartService","TermsService","GlobalVarsService",function(a,b,c,d,e,f,g,h,i,j){function k(b,c,d,e,h,i){h(i,function(h){console.log("- Drop course registration request submitted - starting to poll for request status"),g.pollRegistrationRequestStatus(h.id).then(function(){switch(console.log("-- Stop polling - Success"),b){case f.waitlisted:g.removeWaitlistedCourse(c),m++;break;case f.registered:g.removeRegisteredCourse(c),n++}angular.isFunction(d)&&d(),a.$emit("courseDropped",c,b)},function(a){console.log("-- Stop polling - Error",a),angular.isFunction(e)&&e(a.responseItemResults[0].messages[0])},function(){console.log("-- Continue polling")})},function(a){console.log("- Drop course registration request failed",a),angular.isFunction(e)&&e(a.data)})}function l(a,b,c,d,e,h,i){h(i,function(h){console.log("- Update course registration request submitted - starting to poll for request status"),g.pollRegistrationRequestStatus(h.id).then(function(){switch(console.log("-- Stop polling - Success"),a){case f.waitlisted:g.updateWaitlistedCourse(b,c);break;case f.registered:g.updateRegisteredCourse(b,c)}angular.isFunction(d)&&d()},function(a){console.log("-- Stop polling - Error",a),angular.isFunction(e)&&e(a.responseItemResults[0].messages[0])},function(){console.log("-- Continue polling")})},function(a){console.log("- Update course registration request failed",a),angular.isFunction(e)&&e(a.data)})}console.log(">> ScheduleCtrl"),a.getSchedules=g.getSchedules,a.registeredCredits=g.getRegisteredCredits,a.registeredCourseCount=g.getRegisteredCourseCount,a.waitlistedCredits=g.getWaitlistedCredits,a.waitlistedCourseCount=g.getWaitlistedCourseCount,a.userId=j.getUserId,a.courseTypes=f;var m=0,n=0;a.showWaitlist=function(){return a.waitlistedCredits()>0||m>0},a.showSchedule=function(){return a.showWaitlist()||a.registeredCredits()>0||n>0},a.showGrid=function(){var a=!1;return angular.forEach(h.getCartCourses(),function(b){angular.forEach(b.schedule,function(b){if(!a)for(var c=b.activityOfferingLocationTime,d=0;d<c.length;d++)if(!c[d].isTBA){a=!0;break}})}),a||angular.forEach(g.getScheduledCourses(),function(b){angular.forEach(b.activityOfferings,function(b){if(!a)for(var c=b.scheduleComponents,d=0;d<c.length;d++)if(!c[d].isTBA){a=!0;break}})}),a},a.$on("courseStatusMessageRemoved",function(a,b){switch(b){case f.waitlisted:m--;break;case f.registered:n--}}),a.$on("dropCourse",function(a,b,c,d,e){switch(b){case f.waitlisted:console.log("Drop waitlisted course"),k(b,c,d,e,g.dropFromWaitlist().query,{masterLprId:c.masterLprId});break;case f.registered:console.log("Drop registered course"),k(b,c,d,e,g.dropRegistrationGroup().query,{masterLprId:c.masterLprId})}}),a.$on("updateCourse",function(a,b,c,d,e,h){switch(b){case f.waitlisted:console.log("Update waitlisted course"),l(b,c,d,e,h,g.updateWaitlistItem().query,{courseCode:c.courseCode,regGroupId:c.regGroupId,masterLprId:c.masterLprId,termId:i.getTermId(),credits:d.credits,gradingOptionId:d.gradingOptionId});break;case f.registered:console.log("Update registered course"),l(b,c,d,e,h,g.updateScheduleItem().query,{courseCode:c.courseCode,regGroupId:c.regGroupId,masterLprId:c.masterLprId,termId:i.getTermId(),credits:d.credits,gradingOptionId:d.gradingOptionId})}})}]),angular.module("regCartApp").controller("SearchCtrl",["$scope","$rootScope","$filter","$state","TermsService","SearchService","CourseSearchFacets",function(a,b,c,d,e,f,g){function h(b){b=b||angular.copy(d.params);var c={};angular.forEach(a.facets,function(a){angular.isArray(a.selectedOptions)&&a.selectedOptions.length>0&&(c[a.id]=a.selectedOptions)}),b.filters=Object.keys(c).length>0?JSON.stringify(c):null,d.go("root.search.results",b,{location:"replace",notify:!1})}function i(b){b=b||d.params,a.stateParams=b;var c={};angular.isDefined(b.filters)&&null!==b.filters&&(c=JSON.parse(b.filters)||{}),angular.forEach(a.facets,function(a){var b=[];angular.isDefined(c[a.id])&&(b=c[a.id]),a.selectedOptions=b})}function j(){var b=c("facetFilter"),d=[];angular.forEach(a.searchResults,function(c){b(c,a.facets)&&d.push(c)}),a.filteredResults=d}function k(b){if(null!==b&&(null===m||b!==m)){if(angular.isFunction(l)&&(l(),l=null),!e.getTermId())return console.log("Search blocked - no termId exists"),void(l=a.$on("termIdChanged",function(){l(),l=null,k(b)}));console.log('Searching for "'+b+'"'),m=b,f.searchForCourses().query({termId:e.getTermId(),criteria:b},function(c){m===b?(console.log('Search for "'+b+'" complete. Results: '+c.length),a.searchResults=c,a.searchCriteria=b,j()):console.log('Search completed but not the most recent, ignoring results: "'+b+'" !== "'+m+'"')},function(a){console.log("Error searching for courses: ",a)})}}console.log(">> SearchCtrl"),a.facets=g,a.searchState=d.params,a.searchCriteria=null,a.searchResults=[],a.filteredResults=[],a.$on("termIdChanged",function(){var b=a.searchCriteria;a.searchCriteria="",a.searchResults=[],b&&(m=null,k(b))}),a.$on("$stateChangeSuccess",function(a,b,c){"root.search.results"===b.name&&(i(c),angular.isDefined(c.searchCriteria)&&k(c.searchCriteria))}),a.$on("resultsStateChanged",function(b,c){var d=angular.copy(c);d.searchCriteria=a.searchCriteria,h(d)}),a.$watch("facets",function(){h(),j()},!0);var l,m=null;a.$on("viewDetails",function(b,c){d.go("root.search.details",{searchCriteria:a.searchCriteria,id:c.courseId})})}]).filter("startFrom",function(){return function(a,b){return b=+b,a.slice(b)}}).filter("facetFilter",function(){return function(a,b){var c=!0;return angular.forEach(b,function(b){c&&angular.isArray(b.selectedOptions)&&b.selectedOptions.length>0&&(b.filter(a,b.selectedOptions)||(c=!1))}),c}}),angular.module("regCartApp").controller("SearchDetailsCtrl",["$scope","$rootScope","$state","$filter","$modal","STATUS","FEATURE_TOGGLES","SearchService","CartService","ScheduleService",function(a,b,c,d,e,f,g,h,i,j){function k(b){null===b||null!==a.course&&null!==a.course.courseId&&b===a.course.courseId||(console.log('Loading course "'+b+'"'),w=b,h.getCourse().query({courseOfferingId:b},function(c){if(w===b){var e={},f={};angular.isDefined(c.activityOfferingTypes)&&angular.isArray(c.activityOfferingTypes)&&angular.forEach(c.activityOfferingTypes,function(b){b.formattedOfferings=d("aoFormatter")(angular.copy(b.activityOfferings)),angular.forEach(b.activityOfferings,function(c){c.activityOfferingType=b.activityOfferingType,f[c.activityOfferingCode]=c,angular.forEach(c.regGroupInfos,function(a,b){angular.isUndefined(e[b])&&(e[b]=a),angular.isUndefined(a.activityOfferingIds)&&(a.activityOfferingIds=[]),e[b].activityOfferingIds.push(c.activityOfferingId)}),!a.additionalInfo&&(null!==c.subterm||angular.isArray(c.requisites)&&c.requisites.length>0)&&(a.additionalInfo=!0)}),angular.forEach(b.formattedOfferings,function(a){var b=f[a.aoId];b.flags={},a.flags=b.flags})}),a.availableRegGroups=e,a.aoMap=f,a.course=c,a.updateAOStates(),a.singleRegGroup=m()}else console.log('Course load completed but not the most recent, ignoring: "'+b+'" !== "'+w+'"')},function(a){console.log("Error loading course: ",a)}))}function l(c,d){a.actionType=c,a.actionStatus=null;var e=angular.copy(a.course);e.courseCode=e.courseOfferingCode,e.regGroupId=a.selectedRegGroup.regGroupId,e.regGroupCode=a.selectedRegGroup.regGroupCode,b.$broadcast(d,e,function(){a.actionStatus=f.success},function(){a.actionStatus=f.error})}function m(){var b=Object.keys(a.availableRegGroups);if(1===b.length){var c=[];return angular.forEach(a.course.activityOfferingTypes,function(a){angular.forEach(a.activityOfferings,function(a){v(a,!0)}),c.push.apply(c,a.formattedOfferings)}),a.selectedRegGroup=p(),a.singleRegFormatted=c,!0}return!1}function n(){angular.forEach(a.course.activityOfferingTypes,function(b){a.isAOTypeSelected(b)||1!==a.countEligibleAOs(b.activityOfferings)||angular.forEach(b.activityOfferings,function(b){b.flags.selected||b.flags.disabled||(v(b),a.updateAOStates())})})}function o(b){return angular.isDefined(b.isFull)?b:(b.isFull=!1,angular.forEach(a.course.activityOfferingTypes,function(a){b.isFull||angular.forEach(a.activityOfferings,function(a){!b.isFull&&-1!==b.activityOfferingIds.indexOf(a.activityOfferingId)&&a.seatsOpen<=0&&(b.isFull=!0)})}),b.isWaitlistFull=angular.isNumber(b.maxWaitListSize)&&b.waitListSize>=b.maxWaitListSize,b.isWaitlistAvailable=b.waitListOffered&&!b.isWaitlistFull,b)}function p(){if(a.selectedAOs.length===a.course.activityOfferingTypes.length){var b=r();if(1===b.length)return o(b[0])}return null}function q(b){"object"==typeof b&&angular.isDefined(b.activityOfferingType)&&(b=b.activityOfferingType);var c=null;return angular.forEach(a.selectedAOs,function(a){null===c&&a.activityOfferingType===b&&(c=a)}),c}function r(){var b=a.availableRegGroups;return angular.forEach(a.selectedAOs,function(c){if(null===b){b=[];for(var d in c.regGroupInfos)b.push(a.availableRegGroups[d])}else{var e=[];angular.forEach(b,function(a){angular.isDefined(c.regGroupInfos[a.regGroupId])&&e.push(a)}),b=e}}),b||[]}function s(b){var c=!0;if(!t(b)&&a.hasSelectedAOs()){c=!1;for(var d=r(),e=0;e<d.length;e++)if(angular.isDefined(b.regGroupInfos[d[e].regGroupId])){c=!0;break}}return c}function t(b){return-1!==a.selectedAOs.indexOf(b)}function u(b){a.selectedAOs.splice(a.selectedAOs.indexOf(b),1),b.flags.selected=!1}function v(b,c){var d=q(b.activityOfferingType);null!==d&&u(d),a.selectedAOs.push(b),c||(b.flags.selected=!0)}console.log(">> SearchDetailsCtrl"),a.stateParams=c.params,a.course=null,a.$on("termIdChanged",function(b,d,e){null!==e&&"root.search.details"===a.uiState&&c.go("root.search.results",c.params)}),a.$on("$stateChangeSuccess",function(b,c,d){a.stateParams=d,angular.isDefined(d.id)&&k(d.id)});var w=null;a.availableRegGroups={},a.aoMap={},a.selectedAOs=[],a.selectedRegGroup=null,a.singleRegGroup=!1,a.additionalInfo=!1,a.singleRegFormatted=[],a.clearSelectedAOs=function(){a.selectedRegGroup=null,a.selectedAOs=[],a.updateAOStates()},a.hasSelectedAOs=function(){return a.selectedAOs.length>0},a.isAOTypeSelected=function(a){var b=q(a);return null!==b},a.allowDirectAddToWaitlist=function(){return g.searchDetails.directAddToWaitlist||!1},a.isSelectedRegGroupInCart=function(){return a.selectedRegGroup&&i.isCourseInCart(a.selectedRegGroup.regGroupId)},a.isSelectedRegGroupInWaitlist=function(){return a.selectedRegGroup&&j.isCourseWaitlisted(a.selectedRegGroup.regGroupId)},a.addToCart=function(){a.selectedRegGroup&&l("cart","addCourseToCart")},a.addToWaitlist=function(){a.selectedRegGroup&&a.selectedRegGroup.isWaitlistAvailable&&a.allowDirectAddToWaitlist()&&l("waitlist","registerForCourse")},a.removeActionMessage=function(){a.actionType=null,a.actionStatus=!1},a.$on("showSubterm",function(b,c){var d=a.aoMap[c].subterm;e.open({templateUrl:"partials/additionalInfo.html",controller:"AdditionalInfoCtrl",size:"sm",resolve:{subterm:function(){return d},requisites:void 0}})}),a.$on("showRequisites",function(b,c){var d=a.aoMap[c].requisites;e.open({templateUrl:"partials/additionalInfo.html",controller:"AdditionalInfoCtrl",size:"sm",resolve:{requisites:function(){return d},subterm:void 0}})}),a.$on("toggleAO",function(b,c){var d=a.aoMap[c.aoId],e=!1;if(t(d))u(d);else{if(!s(d))return;v(d),e=!0}a.updateAOStates(),e&&n(),a.selectedRegGroup=p()}),a.countEligibleAOs=function(a){var b=0;return angular.forEach(a,function(a){a.flags.disabled||a.flags.selected||b++}),b},a.updateAOStates=function(){angular.forEach(a.course.activityOfferingTypes,function(b){b.showAll&&a.isAOTypeSelected(b)&&(b.showAll=!1),angular.forEach(b.activityOfferings,function(c){c.flags.selected=t(c),c.flags.disabled=!s(c),c.flags.hidden=b.showAll||c.flags.selected?!1:a.isAOTypeSelected(b)?!0:c.flags.disabled})})}}]).controller("AdditionalInfoCtrl",["$scope","subterm","requisites",function(a,b,c){function d(a){var b=new Date(a);return b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()}a.subterm=b,a.requisites=c,a.startDate=function(){return d(b.startDate)},a.endDate=function(){return d(b.endDate)}}]),angular.module("regCartApp").factory("DetailsFactory",["$injector",function a(b){var c={},a=function(a){var d=c[a];return angular.isUndefined(d)&&(d=b.get(a)),angular.isUndefined(d)?console.log("Search Details configuration "+a+" is not defined"):c[a]=d,d};return a}]),angular.module("regCartApp").filter("creditRangeFormatter",function(){return function(a){var b="";if(a&&angular.isArray(a)){if(1===a.length)b=parseFloat(a[0]);else{var c=parseFloat(Math.min.apply(null,a)),d=parseFloat(Math.max.apply(null,a));b=c+"-"+d}b+=" cr"}return b}}).filter("aoFormatter",["DAY_CONSTANTS","RegUtil",function(a,b){function c(a){return null===a?"":a}function d(a,b){for(a=""+a;a.length<b;)a="0"+a;return a}function e(a,b){return a='<span class="kscr-Search-result-sort">'+b+"</span>"+a}function f(b){for(var c=[],d=0;d<a.dayArray.length;d++)b.indexOf(a.dayArray[d])>-1&&c.push(d);return c.sort().toString()}function g(a){var c=b.convertTimeStringToTime(a);return isNaN(c)&&(c=9999),d(c,4)}return function(a){for(var b=[],h=0;h<a.length;h++){var i=a[h],j=i.scheduleComponents,k=i.instructors,l="",m="",n="",o="",p="",q=void 0,r=!1;if(j&&angular.isArray(j)&&j.length>0){for(var s=0;s<j.length;s++)l+=c(j[s].days),m+=c(j[s].displayTime),n+=c(j[s].buildingCode)+" "+c(j[s].roomCode),s<j.length-1&&(l+="<br />",m+="<br />",n+="<br />");l=e(l,f(j[0].days)),m=e(m,g(j[0].startTime))}if(k&&angular.isArray(k)&&k.length>0){for(var t=0;t<k.length;t++)o+=c(k[t].firstName)+" "+c(k[t].lastName),t<k.length-1&&(o+="<br />");o=e(o,k[0].lastName+k[0].firstName)}p+=i.seatsOpen+"/"+i.seatsAvailable,0===i.seatsOpen&&(p='<span class="kscr-Search-results-no-seats">'+p+"</span>",r=!0),p=e(p,d(i.seatsOpen,3)+d(i.seatsAvailable,3));var u=!1,v=!1;null!==i.subterm&&(u=!0),angular.isArray(i.requisites)&&i.requisites.length>0&&(v=!0),(u||v)&&(q=""),u&&(q+='<span class="kscr-SearchDetails-icon--subterm" ng-click="$emit(\'showSubterm\', searchResult.aoId); $event.stopPropagation();"></span>'),v&&(u||(q+='<span class="kscr-SearchDetails-icon">&nbsp;</span>'),q+='<span class="kscr-SearchDetails-icon--requisites" ng-click="$emit(\'showRequisites\', searchResult.aoId); $event.stopPropagation();"></span>');var w=i.activityOfferingCode,x={activity:i.activityOfferingTypeName,days:l,time:m,instructor:o,location:n,seatsOpen:p,additionalInfo:q,aoId:w,indicator:r};b.push(x)}return b}}]),angular.module("regCartApp").filter("cleanse",function(){return function(a){var b;return b=angular.isString(a)?a.replace(" ",""):a}}),angular.module("regCartApp").filter("formatValidationMessage",["VALIDATION_ERROR_TYPE","GENERAL_ERROR_TYPE","MessageService",function(a,b,c){function d(a,b){var c=g(a.messageKey),d=[];if(a.courseCode&&d.push({masterLprId:a.masterLprId,courseCode:a.courseCode}),a.conflictingCourses&&angular.forEach(a.conflictingCourses,function(a){d.push(a)}),d.length){var e=null,f=[],h=[];b&&(angular.isDefined(b.cartItemId)?e=b.cartItemId:angular.isDefined(b.masterLprId)&&(e=b.masterLprId));for(var i=0;i<d.length;i++){if(d[i].masterLprId){if(d[i].masterLprId===e||h.indexOf(d[i].masterLprId)>=0)continue;h.push(d[i].masterLprId)}d[i].courseCode&&f.push("<strong>"+d[i].courseCode+"</strong>")}f.length&&(c+=" ("+f.join(", ")+")")}return c}function e(a){var b=g(a.messageKey);if(a.maxCredits){var c=parseFloat(a.maxCredits);b+=" (<strong>"+c+" credits</strong>)"}return b}function f(a){var b="";return"string"==typeof a.course&&""!==a.txt&&-1!==a.txt.indexOf(a.course)&&(b=a.txt.replace(a.course,"<strong>"+a.course+"</strong>")),b
}function g(a){return c.getMessage(a)}return function(c,h){var i="";if(c)if("string"==typeof c)i=c;else if(c.txt)i=c.txt;else if(c.messageKey)switch(c.messageKey){case a.timeConflict:i=d(c,h);break;case a.maxCredits:i=e(c);break;case b.noRegGroup:i=f(c);break;default:i=g(c.messageKey)}return i}}]),angular.module("regCartApp").service("CartService",["$q","ServiceUtilities","URLS",function(a,b,c){var d=0,e=0,f=[],g={};this.getCart=function(b){var c=a.defer();return angular.isDefined(g[b])?c.resolve(g[b]):this.getCartFromServer().query({termId:b},function(a){g[b]=a,c.resolve(a)},function(a){c.reject(a)}),c.promise},this.getCartCredits=function(){return d},this.setCartCredits=function(a){d=a},this.getCartCourseCount=function(){return e},this.setCartCourseCount=function(a){e=a},this.getCartCourses=function(){return f},this.setCartCourses=function(a){f.splice(0,f.length),a&&(angular.forEach(a,function(a){f.push(a)}),this.setCartCourseCount(a.length))},this.isCourseInCart=function(a){return b.isCourseInList(a,this.getCartCourses())},this.getCartFromServer=function(){return b.getData(c.courseRegistrationCart+"/searchForCart")},this.addCourseToCart=function(){return b.postData(c.courseRegistrationCart+"/addCourseToCart")},this.removeItemFromCart=function(a){return b.deleteData(a)},this.invokeActionLink=function(a){return b.getData(a)},this.updateCartItem=function(){return b.putData(c.courseRegistrationCart+"/updateCartItem")},this.submitCart=function(){return b.getData(c.courseRegistrationCart+"/submitCart")},this.undoDeleteCourse=function(){return b.getData(c.courseRegistrationCart+"/undoDeleteCourse")}}]),angular.module("regCartApp").service("GlobalVarsService",["STATE","STATUS",function(a,b){var c,d={},e={},f=1;this.getUserId=function(){return c},this.setUserId=function(a){c=a},this.getConflictMap=function(){return d},this.setConflictMap=function(a){angular.equals(a,d)||(d=a)},this.getCorrespondingStatusFromState=function(c){var d=b.new;return a.processing.indexOf(c)>=0?d=b.processing:a.success.indexOf(c)>=0?d=b.success:a.error.indexOf(c)>=0?d=b.error:a.waitlist.indexOf(c)>=0?d=b.waitlist:a.action.indexOf(c)>=0&&(d=b.action),d},this.getCorrespondingMessageFromStatus=function(a){var c="";return a===b.waitlist&&(c="If a seat becomes available you will be registered automatically"),c},this.getCourseIndex=function(a){var b=a.courseCode+(a.regGroup||a.regGroupCode),c=e[b];return isNaN(c)&&(c=f++,e[b]=c),c},this.updateConflicts=function(a,b){for(var c=this.getConflictMap(),d=0;d<a.length;d++){var e=a[d],f=c[e.regGroupId];if(!angular.equals(e.conflicts,f))switch(b){case"REG":"REG"===f.type&&(e.conflicts=f);break;case"WAIT":("REG"===f.type||"WAIT"===f.type)&&(e.conflicts=f);break;default:e.conflicts=f}}}}]),angular.module("regCartApp").factory("loginInterceptor",["$q","$injector","$window","$rootScope",function(a,b,c,d){return{response:function(b){var c=b.data;return"object"!=typeof c&&c.indexOf("Kuali Student Login")>-1?(console.log("Informing user that session has expired..."),d.$broadcast("sessionExpired"),a.reject(b)):b},responseError:function(d){if(0===d.status){console.log("Failed to execute request - trying to login");var e=b.get("LoginService");e.logOnAsAdmin().query({userId:"admin",password:"admin"},function(){console.log("Logged in, reloading page."),c.location.reload()},function(){console.log("Not Logged in, reloading page."),c.location.reload()})}return a.reject(d)}}}]),angular.module("regCartApp").service("LoginService",["ServiceUtilities","URLS",function(a,b){this.logOnAsAdmin=function(){return a.getData(b.developmentLogin+"/login")},this.logout=function(){return a.getData(b.developmentLogin+"/logout")}}]),angular.module("regCartApp").service("MessageService",["$q","$resource",function(a,b){var c=null;this.getMessages=function(){var b=a.defer();return null!==c?b.resolve(c):this.loadMessages().query({},function(a){c=a,b.resolve(c)},function(a){b.reject(a)}),b.promise},this.getMessage=function(a){for(var b="",d=0;d<c.length;d++)if(c[d].messageKey===a){b=c[d].message;break}return b},this.loadMessages=function(){return b("json/messages.json",{},{query:{method:"GET",cache:!1,isArray:!0}})}}]),angular.module("regCartApp").service("RegUtil",[function(){this.convertTimeStringToTime=function(a){var b=a.indexOf(":"),c=a.substring(0,b),d=a.substring(b+1,a.indexOf(" ")),e=-1!==a.toLowerCase().indexOf("pm"),f=60*parseInt(c);return f+=parseInt(d),e&&"12"!==c&&(f+=720),f}}]),angular.module("regCartApp").service("ScheduleService",["$q","$timeout","URLS","STATUS","ServiceUtilities","GlobalVarsService",function(a,b,c,d,e,f){var g,h,i=0,j=0,k=0,l=[],m=[],n={};this.getSchedule=function(b,c){var d=a.defer();return c||(c=!1),angular.isDefined(n[b])&&!c?d.resolve(n[b]):this.getScheduleFromServer().query({termId:b},function(a){n[b]=a,d.resolve(a)},function(a){d.reject(a)}),d.promise},this.getRegisteredCredits=function(){return g},this.setRegisteredCredits=function(a){g=a},this.getRegisteredCourseCount=function(){return i},this.setRegisteredCourseCount=function(a){i=a},this.getWaitlistedCredits=function(){return j},this.setWaitlistedCredits=function(a){j=a},this.getWaitlistedCourseCount=function(){return k},this.setWaitlistedCourseCount=function(a){k=a},this.getRegisteredCourses=function(){return l},this.getWaitlistedCourses=function(){return m},this.getScheduledCourses=function(){return l.concat(m)},this.removeRegisteredCourse=function(a){this.getRegisteredCourses().splice(this.getRegisteredCourses().indexOf(a),1),this.setRegisteredCredits(parseFloat(this.getRegisteredCredits())-parseFloat(a.credits)),this.setRegisteredCourseCount(parseInt(this.getRegisteredCourseCount())-1)},this.removeWaitlistedCourse=function(a){this.getWaitlistedCourses().splice(this.getWaitlistedCourses().indexOf(a),1),this.setWaitlistedCredits(parseFloat(this.getWaitlistedCredits())-parseFloat(a.credits)),this.setWaitlistedCourseCount(this.getWaitlistedCourses().length)},this.updateRegisteredCourse=function(a,b){var c=parseFloat(this.getRegisteredCredits())-parseFloat(a.credits)+parseFloat(b.credits);console.log("registeredCredits = "+c),this.setRegisteredCredits(c)},this.updateWaitlistedCourse=function(a,b){var c=parseFloat(this.getWaitlistedCredits())-parseFloat(a.credits)+parseFloat(b.credits);console.log("waitlistedCredits = "+c),this.setWaitlistedCredits(c)},this.isCourseRegistered=function(a){return e.isCourseInList(a,this.getRegisteredCourses())},this.isCourseWaitlisted=function(a){return e.isCourseInList(a,this.getWaitlistedCourses())},this.getSchedules=function(){return h},this.setSchedules=function(a){h=a},this.updateScheduleCounts=function(a){var b=a.studentScheduleTermResults,c=a.userId,d=0,e=0;l.splice(0,l.length),m.splice(0,m.length),this.setSchedules(b),angular.forEach(b,function(a){angular.forEach(a.registeredCourseOfferings,function(a){d+=parseFloat(a.credits),l.push(a);var b=0;angular.forEach(a.gradingOptions,function(){b++}),a.gradingOptionCount=b}),angular.forEach(a.waitlistCourseOfferings,function(a){e+=parseFloat(a.credits),m.push(a);var b=0;angular.forEach(a.gradingOptions,function(){b++}),a.gradingOptionCount=b})}),this.setRegisteredCourseCount(l.length),this.setRegisteredCredits(d),this.setWaitlistedCredits(e),this.setWaitlistedCourseCount(m.length),f.setUserId(c)},this.pollRegistrationRequestStatus=function(c,e,g){angular.isNumber(e)||(e=1e3),g||(g=a.defer());var h=this;return b(function(){h.getRegistrationStatus().query({regReqId:c},function(a){var b=f.getCorrespondingStatusFromState(a.state);switch(b){case d.new:case d.processing:var i=!1;angular.forEach(a.responseItemResults,function(a){if(!i){var b=f.getCorrespondingStatusFromState(a.state);switch(b){case d.new:case d.processing:i=!0}}}),g.notify(a),i?h.pollRegistrationRequestStatus(c,e,g):g.resolve(a);break;case d.success:g.notify(a),g.resolve(a);break;case d.error:g.reject(a)}},function(a){g.reject(a)})},e),g.promise},this.getScheduleFromServer=function(){return e.getData(c.courseRegistration+"/studentSchedule")},this.dropRegistrationGroup=function(){return e.deleteData(c.courseRegistration+"/registrationRequest")},this.registerForRegistrationGroup=function(){return e.postData(c.courseRegistration+"/registrationRequest")},this.updateScheduleItem=function(){return e.putData(c.courseRegistration+"/registrationRequest")},this.dropFromWaitlist=function(){return e.deleteData(c.courseRegistration+"/waitlistRegistrationRequest")},this.updateWaitlistItem=function(){return e.putData(c.courseRegistration+"/waitlistRegistrationRequest")},this.getRegistrationStatus=function(){return e.getData(c.courseRegistration+"/registrationStatus")}}]),angular.module("regCartApp").service("SearchService",["ServiceUtilities","URLS",function(a,b){var c=30,d=[];this.searchForCourses=function(){var a=this;return{query:function(b,e,f){var g=Math.round(+new Date/1e3),h=null,i=[];angular.forEach(d,function(a){angular.isDefined(a.timestamp)&&g-a.timestamp<c&&(i.push(a),a.criteria===b.criteria&&a.termId===b.termId&&(h=a))}),d=i,null===h?(h=angular.copy(b),h.timestamp=g,a.searchForCoursesFromServer().query(b,function(a){h.results=a,d.push(h),e(a)},f)):(console.log("- Returning Cached Results (valid for "+(c-(g-h.timestamp))+"s) "),e(h.results))}}},this.searchForCoursesFromServer=function(){return a.getArray(b.scheduleOfClasses+"/search")},this.getCourse=function(){return a.getData(b.scheduleOfClasses+"/courseOfferingDetails")}}]),angular.module("regCartApp").service("ServiceUtilities",["$resource","APP_URL",function(a,b){function c(a){var b=[];for(var c in a)a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}this.getData=function(c){return a(b+c,{},{query:{method:"GET",cache:!1,isArray:!1}})},this.deleteData=function(c){return a(b+c,{},{query:{method:"DELETE",cache:!1,isArray:!1}})},this.postData=function(d){return a(b+d,{},{query:{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",cache:!1,isArray:!1,transformRequest:function(a){return c(a)}}})},this.putData=function(d){return a(b+d,{},{query:{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"PUT",cache:!1,isArray:!1,transformRequest:function(a){return c(a)}}})},this.getArray=function(c){return a(b+c,{},{query:{method:"GET",cache:!1,isArray:!0}})},this.isCourseInList=function(a,b){angular.isString(a)&&(a={regGroupId:a});var c=!1;return angular.forEach(b,function(b){c||b.regGroupId!==a.regGroupId||(c=!0)}),c}}]),angular.module("regCartApp").service("TermsService",["$q","ServiceUtilities","URLS","DEFAULT_TERM",function(a,b,c,d){var e=null;this.getSelectedTerm=function(){return e},this.setSelectedTerm=function(a){e=a},this.getTermId=function(){var a=this.getSelectedTerm();return null!==a?a.termId:null},this.getTermByCode=function(a){var b=null;return angular.isArray(f)&&angular.forEach(f,function(c){c.termCode===a&&(b=c)}),b},this.getTermById=function(a){var b=null;return angular.isArray(f)&&angular.forEach(f,function(c){c.termId===a&&(b=c)}),b};var f=null;this.getTerms=function(){var b=a.defer();return null!==f?b.resolve(f):this.getTermsFromServer().query({termCode:null,active:!0},function(a){f=a,b.resolve(a)},function(a){b.reject(a)}),b.promise};var g={};this.isStudentEligibleForTerm=function(b){var c=a.defer();return b.termId!==d&&(console.log("-- Term eligibility check bypassed - term != default term"),g[b.termId]=!0),angular.isDefined(g[b.termId])?c.resolve(g[b.termId]):this.checkStudentEligibilityForTerm().query({termId:b.termId},function(a){var d=angular.isDefined(a.isEligible)&&a.isEligible||!1;g[b.termId]=d,c.resolve(d,a)},function(a){c.reject(a)}),c.promise},this.checkStudentEligibilityForTerm=function(){return b.getData(c.scheduleOfClasses+"/checkStudentEligibilityForTerm")},this.getTermsFromServer=function(){return b.getArray(c.scheduleOfClasses+"/terms")}}]),angular.module("regCartApp").service("CourseCalendarDataParser",["DAY_CONSTANTS","RegUtil","GlobalVarsService",function(a,b,c){function d(){var b={};return b[a.monday]=[],b[a.tuesday]=[],b[a.wednesday]=[],b[a.thursday]=[],b[a.friday]=[],b}function e(a,b,c){return angular.forEach(b,function(b){if(!b.dropped){var d={courseCode:b.courseCode,regGroup:b.regGroupCode};"CART"===c&&angular.isUndefined(b.activityOfferings)&&(b.activityOfferings=[],angular.forEach(b.schedule,function(a){angular.isUndefined(a.scheduleComponents)&&(a.scheduleComponents=[],angular.forEach(a.activityOfferingLocationTime,function(b){a.scheduleComponents.push(b.time)})),angular.isUndefined(a.activityOfferingTypeName)&&(a.activityOfferingTypeName=a.activityOfferingType),b.activityOfferings.push(a)})),angular.forEach(b.activityOfferings,function(e){angular.forEach(e.scheduleComponents,function(e){a=f(a,d,e,c,b)})})}}),a}function f(b,c,d,e,f){return d.isTBA||angular.forEach(a.dayArray,function(a){d.days.indexOf(a)>-1&&(b=g(b,c,d,a,e,f))}),b}function g(c,d,e,f,g,h){if(!e.startTime||!e.endTime)return c;angular.isArray(c[f])||(c[f]=[],f!==a.saturday||angular.isArray(c[a.sunday])||(c[a.sunday]=[]),f!==a.sunday||angular.isArray(c[a.saturday])||(c[a.saturday]=[]));var i=b.convertTimeStringToTime(e.startTime),j=b.convertTimeStringToTime(e.endTime);i>j&&(j+=1440);var k={index:l(d),courseCode:d.courseCode,startTime:i,endTime:j,type:g,key:d.courseCode+"."+f+"."+i+"."+j,details:h};return c[f].push(k),c}function h(b){var c=["REG","WAIT","CART"],d=[],e=null,f=null,g=60;return angular.forEach(a.dayArray,function(a){var h=b[a];if(angular.isArray(h)){var j={};angular.forEach(h,function(a){var b=a.type;angular.isArray(j[b])||(j[b]=[]),j[b].push(a),(null===e||a.startTime-g<e)&&(e=a.startTime-g),(null===f||a.endTime+g>f)&&(f=a.endTime+g)});var l=[];angular.forEach(c,function(a){angular.forEach(j[a],function(a){l.push(a)})}),i(l),k(l),d.push({day:a,courses:l})}}),0>e&&(e=0),{timeRange:[e,f],days:d}}function i(a){var b=[[]],c={};return angular.forEach(a,function(a){a.conflicts=[],a.lane=0;var d=!1;if(angular.forEach(b,function(e){var f=!1;angular.forEach(e,function(b){j(a,b)&&(m(a,b),m(b,a),f=!0,a.conflicts.push(b.key),b.conflicts.push(a.key))}),f||d||(a.lane=b.indexOf(e),c[a.key]=a.lane,e.push(a),k(e),d=!0)}),!d){var e=b.push([a]);a.lane=e-1,c[a.key]=a.lane}}),angular.forEach(a,function(a){var b=0;angular.forEach(a.conflicts,function(a){c[a]>b&&(b=c[a])}),a.conflictCount=Math.max(b,a.lane)}),a}function j(a,b){return a.startTime<=b.endTime&&a.endTime>=b.startTime}function k(a){return a.sort(function(a,b){return a.startTime===b.startTime?0:a.startTime<b.startTime?-1:1}),a}function l(a){return c.getCourseIndex(a)}function m(a,b){var c=a.details.regGroupId,d={courseCode:b.details.courseCode,regGroupCode:b.details.regGroupCode,type:b.type};angular.isArray(n[c])||(n[c]=[]);for(var e=!1,f=0;f<n[c].length;f++)if(angular.equals(n[c][f],d)){e=!0;break}e||n[c].push(d)}var n;this.buildCalendar=function(a,b,f){n={};var g=d();a&&(g=e(g,a,"REG")),b&&(g=e(g,b,"WAIT")),f&&(g=e(g,f,"CART"));var i=h(g);return c.setConflictMap(n),c.updateConflicts(a,"REG"),c.updateConflicts(b,"WAIT"),i}}]),angular.module("regCartApp").directive("courseCalendar",function(){return{restrict:"E",scope:{size:"@"},templateUrl:"partials/courseCalendar.html",controller:["$scope","CourseCalendarDataParser","CartService","ScheduleService",function(a,b,c,d){a.courseFilter=function(b){var c=!0;switch(b.type){case"REG":c=!a.hideRegistered;break;case"WAIT":c=!a.hideWaitlisted;break;case"CART":c=!a.hideCart}return c},a.timeFilter=function(b){var c=b.getHours();return a.visibleTimeRange[0]/60<=c&&c<=a.visibleTimeRange[1]/60},a.selectedCourse=null,a.$on("course-clicked",function(b,c){a.selectedCourse=a.selectedCourse&&a.selectedCourse.index===c.index?null:c,a.$apply()}),a.clearSelectedCourse=function(){a.selectedCourse=null};var e=a.size;"small"!==e&&(e="large"),a.calendarSize=e,a.hideRegistered=!1,a.hideWaitlisted=!1,a.hideCart=!1,a.visibleTimeRange=[],a.times=[];for(var f=0;24>f;f++)a.times.push(new Date(0,0,0,f,0,0,0));a.registered=d.getRegisteredCourses(),a.waitlisted=d.getWaitlistedCourses(),a.cart=c.getCartCourses();var g=function(c){if(c){var d=b.buildCalendar(a.registered,a.waitlisted,a.cart);a.visibleTimeRange=[60*Math.floor(d.timeRange[0]/60),60*Math.ceil(d.timeRange[1]/60)],a.days=d.days}};g(!0),a.$watchCollection("registered",g),a.$watchCollection("waitlisted",g),a.$watchCollection("cart",g)}]}}),angular.module("regCartApp").directive("courseCalendarLane",["$timeout","$window",function(a,b){return{restrict:"CAE",link:function(c,d,e){c.scrollAfter=e.scrollAfter||null,c.updateLaneHeight=function(){var a=0;angular.forEach(c.day.courses,function(b){a<b.lane+1&&(a=b.lane+1)});var b=d.children();if(b.length>0){var e=d.children()[0].offsetHeight,f=e*a;e>0&&f>0&&d.height(f)}},a(c.updateLaneHeight),angular.element(b).on("resize",function(){a(c.updateLaneHeight)}),c.$on("updateLaneHeight",function(){a(c.updateLaneHeight)})}}}]),angular.module("regCartApp").directive("courseCalendarItem",["$timeout","$window",function(a,b){return{restrict:"CAE",link:function(c,d){function e(){var a=c.visibleTimeRange,b=a[1]-a[0],e=c.course.endTime-c.course.startTime,g=100*e/b,h=100*(c.course.startTime-a[0])/b;c.course.layout={position:h,proportion:g},d.css({left:h+"%",top:h+"%",height:g+"%",width:g+"%"}),f(),c.$emit("updateLaneHeight")}function f(){if(angular.isUndefined(c.course.layout))return void e();var a={left:c.course.layout.position+"%",top:c.course.layout.position+"%",height:c.course.layout.proportion+"%",width:c.course.layout.proportion+"%"};if(c.course.conflictCount>0){var b=d.parent();if(b.width()>b.height())a.top=c.course.lane*d[0].offsetHeight+"px";else{var f=100;c.course.conflictCount>0&&(f=100/(c.course.conflictCount+1)),a.left=f*c.course.lane+"%",a.width=f+"%"}}d.css(a)}a(e),angular.element(b).on("resize",function(){a(f)}),d.bind("click",function(){c.$emit("course-clicked",c.course)})}}}]),angular.module("regCartApp").directive("courseCard",function(){return{transclude:!0,scope:{schedules:"=",credits:"=",type:"@"},templateUrl:"partials/courseCard.html",controller:"CardCtrl"}}).directive("courseAccordion",function(){return{restrict:"E",transclude:!0,scope:{course:"=",type:"@",cardIndex:"=",cartId:"="},templateUrl:"partials/courseAccordion.html",controller:"CardCtrl"}}).controller("CardCtrl",["$scope","$timeout","GlobalVarsService","TermsService","CartService","ScheduleService","STATUS","GRADING_OPTION","COURSE_TYPES",function(a,b,c,d,e,f,g,h,i){function j(){var b;switch(a.type){case i.waitlisted:b={heading:"Waitlisted",prefix:"waitlisted",prefix2:"waitlist_",prefix3:"waitlist_",remove:"Remove"};break;case i.cart:b={heading:"Cart",prefix:"cart",prefix2:"",prefix3:"cart_",remove:"Remove"};break;default:b={heading:"Registered",prefix:"reg",prefix2:"",prefix3:"schedule_",remove:"Drop"}}return b}function k(a){return a.credits=a.newCredits,a.gradingOptionId=a.newGrading,a}function l(a){var c=angular.copy(a);k(a),a.editing=!1,a.isopen=!1,a.gradingOptionId!==c.gradingOptionId&&(a.editGradingOption=!0,b(function(){a.editGradingOption=!1},2e3)),a.credits!==c.credits&&(a.editCredits=!0,b(function(){a.editCredits=!1},2e3))}a.config=j(),a.courseTypes=i,a.courseOfferings=function(b){var c;switch(a.type){case i.waitlisted:c=b.waitlistCourseOfferings;break;default:c=b.registeredCourseOfferings}return c},a.cancelDropConfirmation=function(a){a.dropping=!1},a.showBadge=function(a){return a.gradingOptionId!==h.letter||a.editGradingOption},a.editItem=function(a){a.newCredits=a.credits,a.newGrading=a.gradingOptionId,a.editing=!0},a.gradingOption=function(b){return b.gradingOptions[a.course.gradingOptionId]},a.courseIndex=function(a){return angular.isDefined(a.index)&&a.index||(a.index=c.getCourseIndex(a)),a.index},a.removeStatusMessage=function(b){b.statusMessage=null,a.$emit("courseStatusMessageRemoved",a.type,b)},a.dropCourse=function(b){switch(a.type){case i.cart:a.$emit("deleteCartItem",b);break;default:console.log("Open drop confirmation"),b.dropping=!0}},a.dropCourseConfirmed=function(b){b.dropping=!1,b.dropProcessing=!0,b.statusMessage={txt:"<strong>"+b.courseCode+" ("+b.regGroupCode+")</strong> drop processing",type:g.processing},a.$emit("dropCourse",a.type,b,function(){b.dropped=!0,b.dropProcessing=!1;var c;switch(a.type){case i.registered:c="<strong>"+b.courseCode+" ("+b.regGroupCode+")</strong> dropped successfully";break;case i.waitlisted:c="Removed from waitlist for <strong>"+b.courseCode+" ("+b.regGroupCode+")</strong> successfully"}b.statusMessage={txt:c,type:g.success}},function(a){b.dropProcessing=!1,b.statusMessage={txt:a,type:g.error}})},a.updateItem=function(b){console.log("Updating "+a.type+" course. Grading: "+b.newGrading+", Credits: "+b.newCredits),b.requestProcessing=!0;var c=angular.copy(b);k(c),a.$emit("updateCourse",a.type,b,c,function(){b.requestProcessing=!1,l(b)},function(a){b.requestProcessing=!1,b.statusMessage={txt:a,type:g.error}})},a.parseConflicts=function(a){var b="";if(angular.isArray(a)&&a.length>0)for(var c=0;c<a.length;c++)c>0&&(b+=", "),b+=a[c].courseCode;return b}}]),angular.module("regCartApp").directive("courseOptions",function(){return{restrict:"E",transclude:!0,scope:{course:"=",maxOptions:"@max",prefix:"@",showAll:"@",moreButtonSelectBehavior:"@moreBehavior",cancelFn:"&onCancel",submitFn:"&onSubmit"},templateUrl:"partials/courseOptions.html",controller:["$scope","$modal",function(a,b){function c(a,b,c){if(a.length<=g)return!0;var d=a.indexOf(b),e=a.indexOf(c),f=2,h=Math.max(0,Math.min(d-f,a.length-g)),i=Math.min(h+g,a.length)-1;return e>=h&&i>=e}function d(){var c=a.$new();c.course=angular.copy(f),c.cancel=function(){},c.submit=function(){},f.editing=!1;var d=b.open({backdrop:"static",template:'<div class="kscr-AdditionalOptions"><course-options course="course" show-all="true" max="'+g+'" prefix="modal_'+(a.prefix?a.prefix:"")+'" on-submit="modalSubmit()" on-cancel="modalCancel()"></course-options></div>',scope:c,controller:["$scope",function(a){a.showAllCreditOptions=!0,a.showAllGradingOptions=!0,a.modalCancel=function(){a.$dismiss("cancel")},a.modalSubmit=function(){a.$close(a.course)}}]});d.result.then(function(b){f.newGrading=b.newGrading,f.newCredits=b.newCredits,a.submit()},function(){a.cancel()})}function e(){a.showAllCreditOptions=h,a.showAllGradingOptions=h}var f=a.course,g=a.maxOptions||4,h=a.showAll?!0:!1,i=a.moreButtonSelectBehavior||"expand";a.showAllCreditOptions=h,a.showAllGradingOptions=h,a.gradingOptions=[],f&&f.gradingOptions&&angular.forEach(f.gradingOptions,function(a,b){this.push({key:b,label:a})},a.gradingOptions),f.creditOptions.sort(function(a,b){var c=parseFloat(a),d=parseFloat(b);return c===d?0:c>d?1:-1}),a.creditOptionsFilter=function(b){return!f||a.showAllCreditOptions?!0:c(f.creditOptions,f.credits,b)},a.gradingOptionsFilter=function(b){return!f||a.showAllGradingOptions?!0:c(Object.keys(f.gradingOptions),f.grading,b.key)},a.showMoreCreditOptions=function(){"expand"===i?a.showAllCreditOptions=!0:d()},a.showMoreGradingOptions=function(){"expand"===i?a.showAllGradingOptions=!0:d()},a.shouldShowMoreCreditOptionsToggle=function(){return!a.showAllCreditOptions&&f.creditOptions.length>g},a.shouldShowMoreGradingOptionsToggle=function(){return!a.showAllGradingOptions&&Object.keys(f.gradingOptions).length>g},a.cancel=function(){console.log("Canceling options changes"),f.newCredits=f.credits,f.newGrading=f.grading||f.gradingOptionId,f.status="",f.editing=!1,a.cancelFn&&a.cancelFn({course:f}),e()},a.submit=function(){console.log("Submitting options form"),a.submitFn&&a.submitFn({course:f}),e()},a.showGradingHelp=function(){b.open({templateUrl:"partials/gradingOptionsHelp.html"})}}]}}),angular.module("regCartApp").directive("focusMe",["$timeout","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.focusMe);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})}),d.bind("blur",function(){a(function(){d[0].focus()})})}}}]).directive("focusOnce",["$timeout","$parse",function(a,b){return{link:function(c,d,e){var f=b(e.focusOnce);c.$watch(f,function(b){b===!0&&a(function(){d[0].focus()})})}}}]).directive("dropMenu",["$window",function(a){return{controller:["$scope",function(b){return angular.element(a).bind("resize",function(){b.dropMenu===!0&&(b.dropMenu=!1)})}],templateUrl:"dropMenu.html"}}]).directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}]);var maskUtils={mask:function(a,b){return b?b.remove():b=angular.element('<div class="util-Mask"/>'),a.append(b),a.addClass("util-Mask--masked"),b},unmask:function(a,b){b&&(b.remove(),b=null,a.removeClass("util-Mask--masked"))},resetZIndex:function(a,b){a.css("zIndex",b)},updateZIndex:function(a,b){var c=b.css("zIndex"),d=a.css("zIndex");return a.css("zIndex",c+1),d}};angular.module("regCartApp").directive("maskScreen",["$timeout","$document",function(a,b){return{restrict:"A",scope:{maskScreen:"="},link:function(c,d){function e(){j=maskUtils.mask(i),j.bind("click",function(){f()}),h=maskUtils.updateZIndex(d,j),k=!0}function f(){maskUtils.unmask(i,j),maskUtils.resetZIndex(d,h),k=!1,a(function(){c.maskScreen=!1})}function g(a){a&&!k?e():!a&&k&&f()}var h,i=b.find("body"),j=null,k=!1;c.$watch("maskScreen",g),g(c.maskScreen),d.bind("$destroy",f)}}}]),angular.module("regCartApp").directive("maskWhen",["$timeout",function(a){return{restrict:"A",scope:{maskWhen:"="},link:function(b,c){function d(){g=maskUtils.mask(c),g.bind("click",function(){e()}),h=!0}function e(){maskUtils.unmask(c,g),h=!1,a(function(){b.maskWhen=!1})}function f(a){a&&!h?d():!a&&h&&e()}var g=null,h=!1;b.$watch("maskWhen",f),f(b.maskWhen),c.bind("$destroy",e)}}}]),angular.module("regCartApp").directive("searchDetailsList",["$timeout","$animate","DetailsFactory",function(a,b,c){return{restrict:"E",templateUrl:"partials/searchDetailsList.html",scope:{searchDetails:"=",selectable:"=",config:"@"},link:function(d){var e=new c(d.config);d.sections=e.getSections(d.searchDetails),b.enabled(!1,angular.element(document.querySelector(".kscr-Search-details-grid")));for(var f=0;f<d.sections.length;f++)d.sections[f].tabs=angular.copy(e.tabs),d.sections[f].tab=angular.copy(e.selectedTab);d.fieldOptions=e.fieldOptions,d.icons=e.icons,d.select=function(a,b){a.tab=b;for(var c=0;c<a.tabs.length;c++)a.tabs[c].selected=a.tabs[c].id===b||"all"===b},d.selectRow=function(a){d.selectable&&!angular.isUndefined(e.selectEvent)&&d.$emit(e.selectEvent,a)};var g=20;d.limit=g,d.$watch("limit",function(){d.limit<d.searchDetails.length&&a(function(){d.limit+=g},250)})}}}]),angular.module("regCartApp").directive("searchFacet",["SearchFacetService",function(a){return{restrict:"ECA",scope:{facet:"=",results:"="},templateUrl:"partials/searchFacet.html",controller:["$scope",function(b){function c(a,c){return angular.forEach(a,function(a){a.count=0}),angular.forEach(c,function(c){angular.forEach(a,function(a){b.facet.filter(c,a.value)&&a.count++})}),a}function d(a){angular.isFunction(b.facet.prepare)&&b.facet.prepare(a);var d=b.facet.optionsProvider(a);return angular.isFunction(b.facet.refine)&&(d=b.facet.refine(d,a),d=c(d,a)),d}function e(a){b.options.length>0&&b.clearSelectedOptions();var c=d(a);b.options=c,angular.isDefined(b.facet.autoCollapse)&&!b.facet.autoCollapse||1!==c.length||(b.isCollapsed=!0)}function f(a){var c=-1;if(angular.isArray(a.value))for(var d=0;d<b.facet.selectedOptions.length;d++){for(var e=b.facet.selectedOptions[d],f=!0,g=0;g<a.value.length;g++)if(-1===e.indexOf(a.value[g])){f=!1;break}if(f){c=d;break}}else c=b.facet.selectedOptions.indexOf(a.value);return c}a.initFacet(b.facet),b.options=[],angular.isUndefined(b.facet.selectedOptions)&&(b.facet.selectedOptions=[]),b.$watch("results",function(a){e(a)}),b.clearSelectedOptions=function(){b.facet.selectedOptions=[]},b.hasSelected=function(){return b.facet.selectedOptions.length>0},b.isSelected=function(a){return-1!==f(a)},b.toggleOption=function(a){var c=f(a);-1===c?b.facet.selectedOptions.push(a.value):b.facet.selectedOptions.splice(c,1)}}]}}]).service("SearchFacetService",function(){this.initFacets=function(a){return angular.forEach(a,function(a){this.initFacet(a)},this),a},this.initFacet=function(a){return angular.isFunction(a.optionsProvider)||(a.optionsProvider=function(b){var c=[];return angular.isDefined(a.optionsKey)&&null!==a.optionsKey?angular.forEach(b,function(b){if(angular.isDefined(b[a.optionsKey])){var d=b[a.optionsKey];angular.isArray(d)||(d=[d]),angular.forEach(d,function(a){var b=null;angular.forEach(c,function(c){null===b&&c.value===a&&(b=c)}),null===b&&(b={label:a,value:a,count:0},c.push(b)),b.count++})}}):console.log('Facet "'+a.id+'" is missing the required optionsKey value'),c.sort(function(a,b){return a.label===b.label?0:a.label<b.label?-1:1}),c}),angular.isFunction(a.filter)||(a.filter=function(b,c){function d(a,b){var c=!1;return angular.isArray(a)?angular.forEach(a,function(a){c||(c=d(a,b))}):angular.isArray(b)?angular.forEach(b,function(b){c||(c=d(a,b))}):c=a===b,c}if(angular.isDefined(a.optionsKey)&&null!==a.optionsKey&&angular.isDefined(b[a.optionsKey])){var e=b[a.optionsKey];return d(e,c)}return!1}),a}}),angular.module("regCartApp").directive("searchForm",[function(){return{restrict:"ECA",templateUrl:"partials/searchForm.html",controller:["$scope","$state",function(a,b){function c(){var a=null;return angular.isDefined(b.params)&&angular.isDefined(b.params.searchCriteria)&&(a=b.params.searchCriteria),a}function d(){var d=c();null!==d?d!==a.courseSearchCriteria&&(a.courseSearchCriteria=b.params.searchCriteria):a.courseSearchCriteria=""}a.courseSearchCriteria="",d(),a.$on("$stateChangeSuccess",function(){d()}),a.submit=function(){if(c()!==a.courseSearchCriteria){var d=angular.copy(b.params);angular.forEach(d,function(a,b){switch(b){case"term":case"searchCriteria":break;default:d[b]=null}}),d.searchCriteria=a.courseSearchCriteria,b.go("root.search.results",d)}}}]}}]),angular.module("regCartApp").directive("searchList",["$filter","$animate","$timeout",function(a,b,c){return{restrict:"E",require:"^searchResults",templateUrl:"partials/searchList.html",scope:{searchResults:"=?",searchColumns:"=",searchData:"=?",displayMax:"@displayLimit",state:"=?",searchCriteria:"@",termName:"@",detailsId:"@",defaultField:"@",preprocessor:"@",onClick:"@",prefix:"@",showMobile:"@",last:"=?",noResults:"@"},link:function(d){function e(a,b){if(a!==b){var c={displayLimit:d.displayLimit,page:d.page,predicate:d.predicate||null,reverse:d.predicate?d.reverse:null};d.$emit("resultsStateChanged",c)}}b.enabled(!1,angular.element(document.querySelector(".kscr-Search-row"))),angular.isUndefined(d.searchResults)&&d.preprocessor&&(d.searchResults=a(d.preprocessor)(d.searchData));var f=20;d.limit=0,d.mobileLimit=0,d.$watch("limit",function(){d.limit>0&&d.limit<d.displayLimit?c(function(){d.limit+=f},250):d.limit>d.displayLimit&&(d.limit=d.displayLimit)}),d.$watch("mobileLimit",function(){d.mobileLimit>0&&d.mobileLimit<d.searchResults.length?c(function(){d.mobileLimit+=f},250):d.mobileLimit>d.searchResults.length&&(d.mobileLimit=d.searchResults.length)}),d.displayLimits=[20,50,100],angular.isDefined(d.state)&&(d.displayLimit=parseInt(d.state.displayLimit),d.page=parseInt(d.state.page),d.predicate=d.state.predicate,d.reverse=d.state.reverse||void 0),d.page=d.page||1,-1===d.displayLimits.indexOf(d.displayLimit)&&(d.displayLimit=d.displayLimits[0]),angular.isDefined(d.displayMax)&&d.displayMax&&(d.displayLimit=d.displayMax),d.detailsId={},d.reverseMap={},d.lastPage=function(){return Math.ceil(d.searchResults.length/d.displayLimit)},d.pageRange=function(){for(var a=[],b=d.lastPage(),c=1;b>=c;c++)a.push(c);return a},d.$watch("displayLimit",function(){d.page=1,d.limit+=f}),d.$watch("searchResults",function(){0===d.lastPage()?d.page=d.state.page||1:d.page>d.lastPage()&&(d.page=1),d.mobileLimit+=f}),d.displayRangeMin=function(){return(d.page-1)*d.displayLimit+1},d.displayRangeMax=function(){var a=d.displayRangeMin(),b=a+d.displayLimit-1;return b>d.searchResults.length&&(b=d.searchResults.length),b},d.applyFilter=function(b,c,d){var e=null;
if(c&&angular.isUndefined(b[c])&&-1!==c.indexOf(".")){for(var f,g=b,h=c.split("."),i=0;f=h[i],i<h.length;i++){if(!angular.isDefined(g[f])){g=null;break}g=g[f]}null!==g&&(e=g)}else e=b[c];return angular.isArray(e)&&d?a(d)(e):e},d.getId=function(a){return a[d.detailsId]},d.sortColumn=function(a){a.sortable&&(d.predicate=a.field,d.reverse=d.sortResults(a.field))},d.sortResults=function(a){var b;switch(angular.isUndefined(d.reverseMap[a])&&(d.reverseMap[a]=0),d.reverseMap[a]){case 0:d.reverseMap[a]=1,b=!1;break;case 1:d.reverseMap[a]=2,b=!0;break;case 2:d.reverseMap[a]=0,d.predicate=void 0}return b},d.emitEvent=function(a,b){a&&d.$emit(a,b)},d.hasData=function(a){for(var b=!1,c=0;c<d.searchResults.length;c++){var e=d.applyFilter(d.searchResults[c],a);if(e){b=!0;break}}return b},d.$watch("displayLimit",e),d.$watch("page",e),d.$watch("predicate",e),d.$watch("reverse",e),d.$on("clearSelected",function(){angular.forEach(d.searchResults,function(a){a.selected=!1,a.hidden=!1})}),d.$on("hideRow",function(a,b){angular.forEach(d.searchResults,function(a){a[d.defaultField]===b&&(a.hidden=!0)})}),d.$on("showRow",function(a,b){angular.forEach(d.searchResults,function(a){a[d.defaultField]===b&&(a.hidden=!1)})}),d.$on("showAllRows",function(){angular.forEach(d.searchResults,function(a){a.hidden&&(a.hidden=!1)})})}}}]).directive("searchResults",function(){return{restrict:"E",controller:"SearchResultsCtrl"}}).directive("searchColumn",function(){return{restrict:"E",require:"^searchResults",link:function(a,b,c){if(c.name||c.field||c.filter){angular.isArray(a.searchColumns)||(a.searchColumns=[]);var d={name:c.name,field:c.field,filter:c.filter,order:c.order,url:c.url,sortable:c.sortField,optional:c.optional,checkbox:c.checkbox};d.sortable="false"!==d.sortable,d.optional="true"===d.optional,a.searchColumns.push(d),a.sortSearchColumns()}}}}).controller("SearchResultsCtrl",["$scope","$filter",function(a,b){a.sortSearchColumns=function(){a.searchColumns=b("orderBy")(a.searchColumns,"order")}}]),angular.module("regCartApp").directive("sticky",["$timeout","$window","$document",function(a,b,c){return{restrict:"CA",link:function(d,e,f){a(function(){function d(){p||(n=e.offset().top);var c=l.height()<=e.height(),f=(b.pageYOffset||l.scrollTop())-(l.clientTop||0),j=c;if(!j)if("bottom"===m){var k=n+e.outerHeight(),o=b.innerHeight+f;n&&(i&&n||(i=k),j=i>o,j&&!p&&(i=k))}else i=n,j=f>=i;!p&&j?g():p&&!j&&h(),p&&c&&a(d,500)}function g(){o&&(j||(j=angular.element('<div class="util-sticky-placeholder"/>')),j.css("height",e.outerHeight()+"px"),j.insertBefore(e)),e.addClass("util-sticky--stuck"),p=!0}function h(){j&&(j.remove(),j=null),e.removeClass("util-sticky--stuck"),p=!1}var i,j,k=angular.element(b),l=angular.element(c),m="bottom"===f.sticky?"bottom":"top",n=e.offset().top,o=!angular.isDefined(f.usePlaceholder)||f.usePlaceholder?!0:!1,p=!1;e.addClass("util-sticky"),e.addClass("util-sticky-"+m),k.on("scroll",d),k.on("resize",function(){a(d)}),d(),e.bind("$destroy",function(){j&&(j.remove(),j=null)})})}}}]);